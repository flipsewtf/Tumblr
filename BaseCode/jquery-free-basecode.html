<!-- ----------------------------------------------------
    
    Tumblr Base Code — jQuery-free & a11y/accessibility-friendly
    Rewritten: 01 November 2025
    
    by Flipse / @mournstera.tumblr.com
    
    Full credits, resources, and documentation available at:
    https://github.com/flipsewtf/Tumblr
    
**********************************************************************

    REMs over PX: Theme Sizing Guide
    (Root font-size should always be 16px)

    Why use rem:
    - Makes your theme more accessible.
      Fonts, gaps, and sidebar widths scale with user preferences
      (browser zoom / OS text scaling), helping users who need larger text.
    - 1rem = 16px by default. Other rems are proportional:
      e.g., 2rem = 32px, 0.75rem = 12px.
    - Pixels are still okay for exact sizes (Post widths, Photoset
      gutters) to prevent layout breaks.
    
    20px divided by 16px equals rem size:
    
    20 / 16 = 1.25rem.

    Quick reference:
    
    1px  = 0.0625rem;
    2px  = 0.125rem;
    3px  = 0.1875rem;
    4px  = 0.25rem;
    5px  = 0.3125rem;
    6px  = 0.375rem;
    7px  = 0.4375rem;
    8px  = 0.5rem;
    9px  = 0.5625rem;
    10px = 0.625rem;
    11px = 0.6875rem;
    12px = 0.75rem;
    13px = 0.8125rem;
    14px = 0.875rem;
    15px = 0.9375rem;
    16px = 1rem;
    17px = 1.0625rem;
    18px = 1.125rem;
    19px = 1.1875rem;
    20px = 1.25rem;
    21px = 1.3125rem;
    22px = 1.375rem;
    23px = 1.4375rem;
    24px = 1.5rem;
    25px = 1.5625rem;
    
    *(Tip: For borders, consider a root variable: --border-width: 0.0625rem)*

    Scaling elements:
    - Use `em` for headings, icons (SVG or font icons), etc.
      - `rem` = relative to root <html> (global scaling)
      - `em`  = relative to parent element (scales locally)

    Example:
        h1 {
            font-size: 1.7em;  /* scales with parent */
        }
        svg.bell {
            width: 1.7em;       /* scales with text */
            height: 1.7em;
        }

---------------------------------------------------- -->



<!---

    We're no longer using px values in themes! Well, almost not.
    
    px → rem conversion guide (root font-size should always be = 16px)
    
    Why this matters:
    
    - Using rem instead of px makes your theme more accessible.
      Font sizes, gaps, and sidebar widths will scale with user preferences
      (browser zoom or OS text scaling), helping users who need larger text.
      
    - 1rem = 16px by default in modern browsers. All other rem values
      are proportional (e.g., 2rem = 32px, 0.75rem = 12px).
      
    - Pixels are still used for elements where exact sizing is critical 
      (like Post widths or Photoset gutters), to avoid layout breaks.

    Quick reference table:
    
    1px  = 0.0625rem; - this one is good to remember instead of 1px borders.
                        alternatively create a root variable: --border-width: 0.0625rem; and use that.
    2px  = 0.125rem;
    3px  = 0.1875rem;
    4px  = 0.25rem;
    5px  = 0.3125rem;
    6px  = 0.375rem;
    7px  = 0.4375rem;
    8px  = 0.5rem;
    9px  = 0.5625rem;
    10px = 0.625rem;
    11px = 0.6875rem;
    12px = 0.75rem;
    13px = 0.8125rem;
    14px = 0.875rem;
    15px = 0.9375rem;
    16px = 1rem;
    17px = 1.0625rem;
    18px = 1.125rem;
    19px = 1.1875rem;
    20px = 1.25rem;
    21px = 1.3125rem;
    22px = 1.375rem;
    23px = 1.4375rem;
    24px = 1.5rem;
    25px = 1.5625rem;
    
    For elements that should SCALE with the user's chosen font-size
    - like headings, or icons (SVG or font icons; in this
      theme, Phosphor Icons) - we use `em` instead of `rem`.  
    
    - `rem` is relative to the root `<html>` font-size (16px).  
    - `em` is relative to the parent element's font-size — so if
       the user changes the theme font-size, everything sized
       in `em` scales proportionally.  
       
    Example:
    
    h1 {
        font-size: 1.7em;  /* scales with user-chosen body font-size */
    }
    
    svg.bell {
        width: 1.7em;       /* scales with surrounding text */
        height: 1.7em;      /* scales with surrounding text */
    }
    

----------------------------------------------------->

<!DOCTYPE html> 
<!-- 
    Global layout and theme classes are applied to <html> instead of <body>:

    - { select:Blog Layout }, etc. are global layout options.
    
    Why <html> instead of <body>:
    
    - Keeps all page-level settings in one place
    - Simplifies CSS and JS targeting.
-->
<html lang="en" data-theme="light" class="{select:Blog Layout} {select:Post Info} {select:Tags}">

<head> 
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/> 
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>

<title>
    @{name} | {title}
    
    {block:PermalinkPage}
        {block:PostSummary}: {PostSummary}
    {/block:PostSummary}
    {/block:PermalinkPage}
    
    {block:TagPage}/ #{Tag}{/block:TagPage}
    
    {block:SearchPage}| search: {SearchQuery}{/block:SearchPage}
</title>


{block:Description}
<meta name="description" content="{MetaDescription}"/>
{/block:Description}

<link rel="shortcut icon" href="{Favicon}"/>
<link rel="icon" href="{Favicon}"/>
<link rel="alternate" type="application/rss+xml" href="{RSS}"/>

<script> 
    // where the dark/light mode plugin retrieves setting info
    const storedTheme = localStorage.getItem("theme") ||  
        (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");

    if (storedTheme) { 
        document.documentElement.setAttribute("data-theme", storedTheme);
    }
</script>

{block:Options}

<meta name="image:Sidebar" content=""/>
<meta name="image:Dark mode Sidebar" content=""/>

<meta name="color:Text" content="#121212"/> 
<meta name="color:Link" content="#b0b0b0"/>
<meta name="color:Background" content="#ffffff"/>
<meta name="color:Background 2" content="#f7f7f7"/>
<meta name="color:Borders" content="#ededed"/>
<meta name="color:Accent" content="#d1a983"/>

<meta name="color:Dark mode Text" content="#fcfcfc"/>
<meta name="color:Dark mode Link" content="#b1b1b1"/>
<meta name="color:Dark mode Background" content="#1a1a1a"/>
<meta name="color:Dark mode Background 2" content="#252525"/>
<meta name="color:Dark mode Borders" content="#3d3c3b"/>
<meta name="color:Dark mode Accent" content="#6c8c59"/>

<meta name="select:Font Size" content="0.6875rem" title="11px"/>
<meta name="select:Font Size" content="0.75rem" title="12px"/>
<meta name="select:Font Size" content="0.8125rem" title="13px"/>
<meta name="select:Font Size" content="0.875rem" title="14px"/>
<meta name="select:Font Size" content="0.9375rem" title="15px"/>
<meta name="select:Font Size" content="1rem" title="16px"/>
<meta name="select:Font Size" content="1.0625rem" title="17px"/>
<meta name="select:Font Size" content="1.125rem" title="18px"/>

<meta name="select:Blog Layout" content="head" title="Header"/>
<meta name="select:Blog Layout" content="left" title="Left Sidebar"/>
<meta name="select:Blog Layout" content="right" title="Right Sidebar"/>

<meta name="select:Layout Gap" content="2.5rem" title="40px"/>
<meta name="select:Layout Gap" content="3.75rem" title="60px"/>
<meta name="select:Layout Gap" content="5rem" title="80px"/>
<meta name="select:Layout Gap" content="6.25rem" title="100px"/>

<meta name="select:Sidebar Width" content="12.5rem" title="200px"/>
<meta name="select:Sidebar Width" content="13.75rem" title="220px"/>
<meta name="select:Sidebar Width" content="15rem" title="240px"/>
<meta name="select:Sidebar Width" content="16.25rem" title="260px"/>
<meta name="select:Sidebar Width" content="17.5rem" title="280px"/>

<meta name="select:Sidebar Image Size" content="3.75rem" title="60px">
<meta name="select:Sidebar Image Size" content="5rem" title="80px">
<meta name="select:Sidebar Image Size" content="6.25rem" title="100px">
<meta name="select:Sidebar Image Size" content="7.5rem" title="120px">
<meta name="select:Sidebar Image Size" content="9.375rem" title="150px">

<meta name="select:Sidebar Image Shape" content="square" title="Square">
<meta name="select:Sidebar Image Shape" content="rounded" title="Rounded">
<meta name="select:Sidebar Image Shape" content="circle" title="Circle">
<meta name="select:Sidebar Image Shape" content="blob1" title="Blob 1">
<meta name="select:Sidebar Image Shape" content="blob2" title="Blob 2">

<meta name="select:Post Width" content="350px"/>
<meta name="select:Post Width" content="400px"/>
<meta name="select:Post Width" content="450px"/>
<meta name="select:Post Width" content="500px"/>
<meta name="select:Post Width" content="540px"/>

<meta name="select:Photoset Gutter" content="1px" title="1px"/>
<meta name="select:Photoset Gutter" content="2px" title="2px"/>
<meta name="select:Photoset Gutter" content="3px" title="3px"/>
<meta name="select:Photoset Gutter" content="4px" title="4px"/>

<meta name="select:Post Info" content="info-only-icons" title="Icons"/>
<meta name="select:Post Info" content="info-only-text" title="Text"/>
<meta name="select:Post Info" content="info-both" title="Both"/>

<meta name="select:Tags" content="tags-always" title="Display">
<meta name="select:Tags" content="tags-truncated" title="Truncated">
<meta name="select:Tags" content="tags-hidden" title="Behind Toggle">

<meta name="if:Rounded Content Corners" content=""/>
<meta name="if:Rounded Photoset Corners" content=""/>
<meta name="if:Search Bar" content=""/>
<meta name="if:Featured Tags" content=""/>
<meta name="if:Update Tab" content=""/>

<meta name="text:Body Font" content="Inter"/>
<meta name="text:Post Margin" content="8rem"/>
<meta name="text:Sidebar Title" content="Lorem Ipsum"/>
<meta name="text:Sidebar Description" content="This is where your description text goes. Links and html is allowed."/>

<meta name="text:Home Link Label" content="Home"/>
<meta name="text:Ask Link Label" content="Ask"/>
<meta name="text:Archive Link Label" content="Archive"/>
<meta name="text:Submit Link Label" content="Submit"/>
<!--
    Feature: Sidebar / menu toggle label.
    - If this field is left empty, all navigation links are shown.
    - If filled, all links (except Home and Ask) are hidden inside a
    toggle button using this text. 
-->
<meta name="text:Toggle Label" content=""/>

<meta name="text:Update Text" content="Here is an update."/>
<meta name="text:Activity 1 Icon" content="popcorn"/>
<meta name="text:Activity 1" content="watching"/>
<meta name="text:Activity 2 Icon" content="music-notes"/>
<meta name="text:Activity 2" content="listening"/>
<meta name="text:Activity 3 Icon" content="books"/>
<meta name="text:Activity 3" content="reading"/>
<meta name="text:Activity 4 Icon" content="game-controller"/>
<meta name="text:Activity 4" content="playing"/>
{/block:Options}

{NewPostStyles}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family={text:Body Font}:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

<style>
/* -------------------------------------------------------------
   CSS Variables (Custom Properties)
   
   - Define theme-wide values that can be reused throughout the CSS
   - Makes it easy to change fonts, sizes, colors, spacing, etc.
   
   - Variables that stay consistent should go inside :root.
   
   - Variables that change with toggling dark/light mode should go
   inside:
   
    :root, html[data-theme='light'] {
    
    and also
    
    html[data-theme='dark'] {
    
    
    :root & html[data-theme='light'] are combined as a fallback.
    Please do not change that.
    
------------------------------------------------------------- */
:root { 
    --font: "{text:Body Font}", -apple-system, system-ui, BlinkMacSystemFont, sans-serif;
    --font-size: {select:Font size};
    --gutter: {select:Photoset gutter};
    
    /* there are borders on the post article in this basecode, so we want to keep the size of the chosen post width + 2px/0.125rem for the border. removing border? remove the calc( + 0.125rem) */
    
    --post-width: calc({select:Post width} + 0.125rem);
    --sidebar-width: {select:Sidebar Width};
    --sidebar-image: {select:Sidebar Image Size};
    --layout-gap: {select:Layout Gap};
    --line-height: 1.8;
    
    /* shorthand values for flex and grid, margin and padding.
       I basically go for round 1.7rem, 1rem, 1.2rem, 1.6rem and
       1.9rem, but if you want the "right" px you can do that.
       
       remember it's alwats just px value divided by the number 16:
       So it's 12 / 16 = 0.75rem
    */
       
    --gap1: 0.75rem;   /* 12px */
    --gap2: 1rem;      /* 16px */
    --gap3: 1.25rem;   /* 20px */
    --gap4: 1.5625rem; /* 25px */
    --gap5: 1.875rem;  /* 30px */
    
    --main-margin: 8rem; /* top & bottom margin on <main> */
    --post-margin: {text:Post margin}; /* gap between post (margin-bottom) */
    
    /* 20px - default margin for text elements (paragraphs, headings,
       lists, etc within posts.) Detailed explanation further down the CSS*/
    --text-margin: 1.25rem;
    

    {block:ifRoundedContentCorners}
    /* Shorthand variables for consistent border-radius
       throughout the theme */
    --round1: 0.375rem; /* 6px */
    --round2: 0.625rem; /* 10px */
    --round3: 0.875rem; /* 14px*/
    --round4: 1.125rem; /* 18px*/
    --circle: 100%;
    {/block:ifRoundedContentCorners}

    
    /* Border radius for images and photosets within posts.
       The base code already applies a border to articles/posts,
       so this is set to 0 by default.
    
       You do not need:
       <meta name="if:Rounded Photoset Corners" content=""/>
       in this setup, since posts (<article>) already have a border.
    
       Padding within <article> is controlled by --text-margin.
       Press Ctrl + F and search for var(--text-margin)
       to read more about it further down the CSS.
    */
    {block:ifRoundedPhotosetCorners}
    --photo-corners: 0;
    {/block:ifRoundedPhotosetCorners}
}

:root, html[data-theme='light'] {
    color-scheme: light;
    
     /* paired with .mode-light {display: var(--mode-light);} 
     and .mode-dark {display: var(--mode-dark);} further down the CSS */
    --mode-light: block;
    --mode-dark: none;
    --color-text: {RGBcolor:Text};
    --color-link: {RGBcolor:Link};
    --color-bg1: {RGBcolor:Background};
    --color-bg2: {RGBcolor:Background 2};
    --color-border: {RGBcolor:Borders};
    --color-accent: {RGBcolor:Accent};
}

html[data-theme='dark'] {
    color-scheme: dark;
    
     /* paired with .mode-light {display: var(--mode-light);} 
     and .mode-dark {display: var(--mode-dark);} further down the CSS */
    --mode-light: none;
    --mode-dark: block;
    --color-text: {RGBcolor:Dark mode Text};
    --color-link: {RGBcolor:Dark mode Link};
    --color-bg1: {RGBcolor:Dark mode Background};
    --color-bg2: {RGBcolor:Dark mode Background 2};
    --color-border: {RGBcolor:Dark mode Borders};
    --color-accent: {RGBcolor:Dark mode Accent};
}

/* 
   Temporarily disables CSS transitions when switching themes.
   - Used by the dark mode toggle script to prevent unwanted animation flashes.
   - Applies to all elements under html.theme-transition.
*/
html.theme-transition * {
    transition: none !important;
}

/* ------------------------------------------------------------- CSS RESET */
*,*::before,*::after {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    box-sizing: border-box;
}
* {
    margin: 0;
}
html {
    font-size: 100%; /* standard 16px*/
    height: 100%;
    scroll-behavior: smooth;
}
p:empty {
	display: none;
}
button,
textarea,
select { 
    font: inherit;
}
button {
    border: 0;
    background: transparent;
    padding: 0;
    display: inherit;
    cursor: pointer;
    color: inherit;
    text-transform: inherit;
}
input{
    font: inherit;
    border: none;
    outline: 0;
    padding: 0;
    background-color: transparent;
}
p, h1, h2, h3, h4, h5, h6, ul, ol, li {
    overflow-wrap: break-word;
    word-break: break-word;
}
ul,ol {
    padding: 0;
    margin: 0;
    list-style: none;
}

/*Visually Hidden Utility

- Hides content visually, but keeps it accessible to screen reader
- Useful for accessibility text, labels, or skip links */
.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0 0 0 0);
    clip-path: inset(50%);
    white-space: nowrap;
    border: 0;
}

::selection {
    background-color: rgb(var(--color-accent));
    color:rgb(var(--color-text));
}
/* -------------------------------------------------------------- TOOLTIPS */

/* Note: Tippy.js GitHub repo is archived
(https://github.com/atomiks/tippyjs), but this theme uses a
specific script version that works perfectly with these modifications. */

  
/* Base style for custom-themed tooltips tippy.js */
.tippy-box[data-theme~='custom'] {
    font-size: var(--font-size);

    font-weight: 400;
    text-align: center;
    padding: 0.625rem;
    color: rgb(var(--color-bg1));
    border: 0;
    border-radius: var(--round1);
    background-color: rgb(var(--color-text));
    margin: 1.125rem;
    z-index: 9999999999;
}

/* Smooth fade-in animation for tooltips */
@keyframes smooth-fade-in {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(2px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

/* Smooth fade-out animation for tooltips */
@keyframes smooth-fade-out {
    from {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
    to {
        opacity: 0;
        transform: scale(0.8) translateY(2px);
    }
}

/* Apply smooth fade animation to tooltips */
.tippy-box[data-animation='smooth-fade'] {
    animation-duration: 0.35s;
    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
    will-change: transform, opacity;
}

/* Trigger fade-in when tooltip is visible */
.tippy-box[data-animation='smooth-fade'][data-state='visible'] { 
    animation-name: smooth-fade-in;
}

/* Trigger fade-out when tooltip is hidden */
.tippy-box[data-animation='smooth-fade'][data-state='hidden'] {
    animation-name: smooth-fade-out;
}

/* ----------------------------------------- TUMBLR: LIGHTBOXES, BANNERS.*/
.vignette, #vignette {
    opacity: 0;
}
.lightbox-image, #tumblr_lightbox img {
    box-shadow: none !important;
    border-radius: 0 !important;
    max-width: none;
}
.tmblr-lightbox, #tumblr_lightbox {
    background-color: rgb(var(--color-bg1),.90)!important;
}
.iframe-controls--phone-mobile,
.tmblr-iframe--gdpr-banner,
.tmblr-iframe--app-cta-button,
.gdpr-banner {
    display: none !important;
}
.tmblr-iframe-pushdown {
    padding-top: 0!important; 
}
/* --------------------------------------------------------- SCROLLBARS */

/* Custom scrollbar styles for WebKit */
@supports selector(::-webkit-scrollbar) {
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    ::-webkit-scrollbar-track {
        background-clip: padding-box;
        background-color: rgb(var(--color-bg1));
        border-left: 0.0625rem solid rgb(var(--color-border));
    }
    ::-webkit-scrollbar-thumb {
        background-color: rgb(var(--color-accent));
    }
    ::-webkit-scrollbar-button {
        display: none;
    }
    ::-webkit-scrollbar-corner {
        background-color: rgb(var(--color-bg1));
    }
}

/* Firefox scrollbar styling */
@-moz-document url-prefix() {
    * {
        scrollbar-width: thin;
        scrollbar-color: rgb(var(--color-accent)) rgb(var(--color-bg1));
    }
}

/* --------------------------------------------------------------- GENERAL */
body {
    font-family: var(--font);
    font-size: var(--font-size);
    color: rgb(var(--color-text));
    background-color: rgb(var(--color-bg1));
    height: 100%;
    text-rendering: optimizeLegibility;
    overflow-wrap: break-word;
    line-height: 1;
    font-weight: 400;
    overflow-x: hidden;
    overflow-y: scroll;
}

a {
    color:rgb(var(--color-link));
    text-decoration: none;
    overflow-wrap: anywhere;
    
    &:hover {
        color: rgb(var(--color-accent)); 
    }
}
/* ------------------------------------------------------------ SHORTHANDS */

/* Utility classes for quick layout and spacing adjustments.
   Includes flexbox helpers, gap helpers, column/wrap directions,
   and light/dark mode visibility controls. */
   
.flex { display: flex; } 

.centered { align-items: center; justify-content: center; }

.align-center { align-items: center; }

.justify-center { justify-content: center; }

.between { justify-content: space-between; }

.column { flex-direction: column; }

.wrap { flex-wrap: wrap; }

.gap1 { gap: var(--gap1); }
.gap2 { gap: var(--gap2); }
.gap3 { gap: var(--gap3); }
.gap4 { gap: var(--gap4); }
.gap5 { gap: var(--gap5); }

/* 
   Light and dark mode visibility toggles:
   - The CSS variables --mode-light and --mode-dark are defined 
     inside the theme blocks for [data-theme='light'] and [data-theme='dark'].
   - They control which elements are shown depending on the current theme.
     For example:
       * In light mode → --mode-light: block; --mode-dark: none;
       * In dark mode  → --mode-light: none;  --mode-dark: block;
   - These variables are used by the helper classes below to
     show or hide elements (e.g., theme toggle icons or sidebar images).
*/
.mode-light { display: var(--mode-light); }
.mode-dark  { display: var(--mode-dark); }

/* ------------------------------------------------------------ PRIMARY CONTAINERS */

/* 
   .page-container ensures the footer stays at the bottom:
   
   - Uses flex column layout
   - <main> grows to fill remaining space with flex: 1
   - Works even if content is short or the window is tall.
   
   the markup of the theme:
   
    <div class="page-container">
        <main>
            <aside></aside> (sidebar)
            <section>
                <article><article> (every post container)
            </section>
            <footer></footer>
        </main>
        
        <div>corner icon stuff</div>
        <div>corner icon stuff</div>
    </div>
    
*/
.page-container {
    display: flex;
    flex-direction: column;
    min-height: 100vh;    /* fallback for older browsers */
    min-height: 100dvh;   /* modern dynamic viewport unit */
    justify-content: space-between;
}

/* 
   <main> layout:
   - Uses grid for flexible  layout choices
   
        * first row sizes naturally to content (e.g., top content or heading)
        * second row stretches to fill remaining space
        * this keeps footer pushed to the bottom even with very little content
    
     gap:
     
     8rem = vertical, var(--layout-gap) = { select:Layout Gap }
*/
main {
    display: grid;
    flex: 1;    
    gap: 8rem var(--layout-gap);
    transition: margin-inline 0.5s ease-out; /* pretty horixontal transition*/
    justify-content: center;
    margin: var(--main-margin) 0;
}

/*
   <main> layout Blog Layout options:

   - html.head:
       * Single-column layout
       * Sidebar stacks above content/post

   - html.left:
       * Sidebar on the left of main content/post
       * margin-right adjusted to account for sidebar width
         so the post is centered of the screen

   - html.right:
       * Sidebar on the right of main content/post
       * margin-left adjusted to account for sidebar width
         so the post is centered of the screen
*/


html.head main {
    grid-template-areas:  "sb" "post";
}
html.left main {
    grid-template-areas:  "sb post";
    margin-right: calc(var(--layout-gap) + var(--sidebar-width));
}
html.right main {
    grid-template-areas:  "post sb";
    margin-left: calc(var(--layout-gap) + var(--sidebar-width));
}

/* 
   Footer
   
   - When using .page-container with flex-direction: column
     and main { flex: 1 }, the footer can
     extend past the viewport height and the internet doesn't
     know why.
     
   - Adding a tiny padding (even 1px) prevents the footer
     from overflowing the 100vh limit. */
   
footer.footer-bottom {
    line-height: var(--line-height);
    padding: var(--gap3);
    text-align: center;
}


/* Some icon fonts aren’t perfectly square by default,
   so we force a 1:1 aspect ratio to keep all icons consistently square.
   In this base code I'm using Phosphor Icons.*/
   
i.ph,
i.ph-thin,
i.ph-light,
i.ph-bold,
i.ph-fill,
i.ph-duotone {
    aspect-ratio: 1/1;
}

/* ------------------------------------------------------------ SIDEBAR */

aside {
    grid-area: sb;
}

/* SIDEBAR IMAGE
   - every shape has its own css
   - { select:Sidebar Image Shape } is a class on
   the <div class="sidebar-image"> so nesting goes smoothly
*/ 
.sidebar-image {
    margin-bottom: var(--gap4);

    img {
        width: var(--sidebar-image);
        height: var(--sidebar-image);
        object-fit: cover;
        overflow-clip-margin: unset;
    }
    
    &.rounded img { 
        border-radius: 0.7em;
    }

    &.circle img {
        border-radius: 100%;
    }
    &.blob1 img {
        -webkit-clip-path: url(#blob1); 
        clip-path: url("#blob1"); 
    }
    &.blob2 img {
        -webkit-clip-path: url(#blob2); 
        clip-path: url("#blob2"); 
    }
}

/*SIDEBAR TITLE*/
h3.sidebar-title {
    font-size: 1.4em;
    font-weight: 700;
    line-height: 1.5;
    margin-bottom: var(--gap1);
}

/*SIDEBAR DESCRIPTION*/
.sidebar-description {
    line-height: 1.6;
    color: rgb(var(--color-text));
    margin-bottom: var(--gap3);
}

/*SEARCH BAR*/
form.search {
    width: 100%;
    background: rgb(var(--color-bg2));
    border: 0.0625rem solid rgb(var(--color-border));
    padding: 0.6rem;
    border-radius: var(--round2);
    margin-bottom: var(--gap3);
    
    input {
        width: 100%;
        color: rgb(var(--color-text));

        &::placeholder {
            padding: 0;
            color: rgb(var(--color-text));
            opacity: 1;
        }
    }
    button.search {
        display: inline-flex;
        color: rgb(var(--color-text));
        flex-shrink: 0;
        font-size: 1.4em;
    }
}

form.search:focus-within {
    background: rgb(var(--color-bg1));
    border-color: rgb(var(--color-accent));
    
    button.search {
        color: rgb(var(--color-accent));
    }
}

/* ----- SIDEBAR NAVIGATION/LINKS ----- */

/* Base link/button colors for all navigation
types (menu, menu-toggle, submenu,
sub-toggle buttons) */

nav.menu a,
nav.menu-toggle a,
nav.submenu a,
button.sub-toggle {
    color: rgb(var(--color-text));
}

/* Toggle navigation container:
   - Hidden by default
   - Expands/collapses via max-height transition JS
   - Inner nav.submenu spacing managed here
*/
#submenu-container {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
    padding-block: 0;
    margin-bottom: var(--gap2);

    nav.submenu {
        margin: var(--gap2) 0;
    }
}

/* Hover states for links:
   - Subtle underline for accessibility/clarity
   - Menu-toggle buttons get accent color on hover
*/
nav.menu a:hover,
nav.submenu a:hover {
    color: rgb(var(--color-text));
    text-decoration: underline;
    text-decoration-color: rgb(var(--color-accent));
    text-underline-offset: 2px;
    text-decoration-thickness: 1px;
}
nav.menu-toggle a:hover,
button.sub-toggle:hover {
    color: rgb(var(--color-link));
}

/* Arrow rotation for submenu toggle */
.nav-spin {
    display: inline-flex;
    transition: rotate 0.5s ease;
    font-size: 1.2em;
}
.nav-spin.active {
    rotate: -180deg;
}


/*  FEATURED TAGS
   - Hides /tagged/ links from the main menu
     and throws them into its own section
   - Styles the featured tags list and counts
   - The script (find it in <script>) populates the
   .total spans dynamically
*/
{block:ifFeaturedTags}
nav.menu a[href*="/tagged"],
nav.submenu a[href*="/tagged"],
.featured-tags a {
    display: none;
}
.featured-tags a:not([href*="/tagged"]){
    display: inline-flex;
}
{/block:ifFeaturedTags}

.featured-tags {
    margin-top: var(--gap3);
    
    a {
        display: flex;
        align-items: center;
        border-radius: var(--round3);
        background: rgb(var(--color-text));
        color: rgb(var(--color-bg1));
        padding: 0.5rem 0.6rem;
        
        &:hover {
            color: rgb(var(--color-bg1));
            background: rgb(var(--color-accent));
        }

    }
    a:not([href*="/tagged"]) {
        display:none;
    }
    span.total {
        display: flex;
        align-items: center;
        margin-left: 0.25rem;
        
        &::before {
            content:'(';
        }
        &::after {
            content:')';
        }
    }
}

/* Specific overrides for html.head / html.left / html.right
   - These are placed at the end to ensure they aren't overridden
     by the more general sidebar rules above.
   - html.head: sidebar takes post-width
   - html.left/right: sidebar takes sidebar-width, and inner sidebar sticks
*/

/* CSS specific for html.head */ 
html.head {
    
    aside {
        width: var(--post-width);
    }
}

/* CSS specific for html.left AND html.right */ 
html.left, html.right {
    
    aside{
        width: var(--sidebar-width);
    }
    .sidebar-inner {
        position: sticky;
        top: var(--main-margin);
    }
}

/* ------------------------------------------------------------ PAGINATION */
nav.pagi {
    margin-top: var(--main-margin);

    a[class*="page"] {
        display: flex;
        cursor: default;
        color: rgb(var(--color-text));

        span.pagi-icon {
            display: inline-flex;
            background: rgb(var(--color-text));
            padding: 0.8rem;
            border-radius: var(--circle);
            font-size: 1.3em;
            color: rgba(var(--color-bg1), 0.4); /* faded for inactive by default */

            i {
                display: inline-flex; /* make phosphor icon square for alignment */
            }
        }


        /* Hover for active pages */
        &.has_page:hover span.pagi-icon {
            color: rgb(var(--color-bg1)); /* full opacity */
            background: rgb(var(--color-accent));
        }
    }

    /* active links */
    a.has_page {
        cursor: pointer;
        color: rgb(var(--color-text));

        span.pagi-icon {
            color: rgb(var(--color-bg1)); /* full opacity for active links */
        }
    }
}

/* -----------------------------------------------------  SECTION POSTS */

/* The main post column */
section {
    grid-area: post;
    width: var(--post-width);
}

/* Wrapper for each Tumblr post, including tags, date, etc. */
article {
    width: 100%;
}

/* Adds margin below every post except the last one */
article:not(:last-of-type) {
    margin-bottom: var(--post-margin);
}

/* Wrapper for the actual content of a Tumblr post. */
.post-content {
    border: 0.0625rem solid rgb(var(--color-border));
    background: rgb(var(--color-bg2));
    overflow: hidden;
    border-radius: var(--round2);
}

/* -----------------------------------------------------  Line height handling

   Line-height is applied directly to the text elements inside each post
   rather than on <body>, so it doesn't affect buttons, images, or other
   elements that rely on square/consistent dimensions.

   This includes headings, paragraphs, lists, blockquotes, ask questions,
   and note lists.

   I use :is() instead of :where() to avoid accidentally overriding other
   inherited line-heights.
*/
:is(
    article h1,
    article h2,
    article h3,
    article p,
    article ul,
    article ol,
    article blockquote,
    ol.notes) {
    line-height: var(--line-height);
}

/* -------------------------------------------- CAPTIONS, UL, OL HEADLINES */

/* If you have a border (like this basecode has) on the post wrapper,
    We can have a nice snug fit for photos/photosets, and place the
    padding of the wrapper on everything else. The other way won't work
    due to negative space not handling NPF photos that great.
    
    you can add     figure:has(iframe), .video:has(iframe),
    to the list, and *some videos* will have padding as well.
    There are too many variables to catch everything.
    
    */


article :is(
    .poll-post a.poll-row,  /*poll row */
    .custom-link-block,  /*link block */
    figcaption.audio-caption,  /* audio block */
    p:not(.link-description),  /*the <p> inside the link block: .link-description, is already inside a parent with margin so we're exluding it here*/
    h1,
    h2,
    h3,
    ul,
    ol,
    pre,
    blockquote) {
    margin: var(--text-margin); /* make it `margin: var(--text-margin) 0;` if your post wrapper does not have a border or framing */
}


/*ul and ol stuff have been reset in the css reset portion at the top of the CSS stylesheet. Now we make it work for our themes*/
article ul, article ol {
    padding-left: var(--text-margin);
}
article ul {
    list-style: outside;
}
article ol {
    list-style: decimal;
}
article ul li:hover::marker,
article ol li:hover::marker {
    color: rgb(var(--color-accent));
}
article ol li, article ul li {
    padding-left: var(--gap1);
}


article h1,
.poll-post .poll-question { /* poll header is a <p> but big as hell, so we make it match */
    font-size: 1.5em;
    font-weight: 700;
}
article h2 {
    font-size: 1.3em;
    font-weight: 700;
}
article h3 {
    font-size: 1.2em;
    font-weight: 700;
}
/* ----------------------------------------------- BLOCKQUOTES/QUOTE POSTS */

/* Tumblr blockquotes are messy:
   - article blockquote: legacy Tumblr quotes
   - blockquote.npf_indented: from NPF posts
   - p.npf_quote: usually styled quotes, often reblogs of
     legacy quotes becomes p.npf_quote

   We standardize them for consistency. */

article blockquote,
blockquote.npf_indented {
    border-left: 0.0625rem solid rgb(var(--color-accent));
    padding-left: var(--text-margin);
    margin-left: var(--text-margin)!important;
}

article blockquote p {
    margin: 0!important; /* remove extra spacing inside legacy blockquotes */
}

/* NPF quotes */
p.npf_quote {
    font-size: inherit;
    font-family: inherit;
    vertical-align: inherit;
    font-style: normal;
    border-left: 0.125rem solid rgb(var(--color-accent));
    padding-left: var(--text-margin);
    margin-left: var(--text-margin);
}

/* Attributions inside NPF photos/posts
   - width:auto ensures responsiveness */
.post-content div.npf_row .npf_col figure p.tmblr-attribution,
.post div.npf_row .npf_col figure p.tmblr-attribution,
body div.npf_row .npf_col figure p.tmblr-attribution {
    width: auto;
}

/* ----------------------------------------------- USER/AVATAR/REBLOG HEADERS */ 

/* 
   If your post wrapper does not have a border or framing,
   you may want to remove the vertical spacing and only keep horizontal spacing.

   In that case, set:

   .reblog-header {
       margin: var(--text-margin) 0;
   }

   And leave the non-original rule empty:

   .reblog-header:is(:not(.original)) {
   }

   This keeps spacing consistent without adding unnecessary top/bottom gaps,
   similar to how we handle captions, headings, and lists in the main post content.
*/


/*  user original  */
.reblog-header {
    margin: var(--text-margin);
}
/*  user reblog  */
.reblog-header:is(:not(.original)) {
    border-top: 0.0625rem solid rgba(var(--color-border));
    margin: var(--text-margin) 0;
    padding: var(--text-margin) var(--text-margin) 0 var(--text-margin);
}
/*  user avatar */
.reblog-header img {
    width: 2em;
    height: 2em;
    border-radius: var(--round1);
}
/*  username text */
.reblog-header .user {
    color: rgb(var(--color-text));
    font-weight: 600;
}
/*  username url text hover */
.reblog-header a.user:hover {
    color: rgb(var(--color-accent)); 
}
/* ---------------------------------------------------------- NPF PHOTOSET */
article img {
    display: block;
    max-width: 100%;
    height: auto;
}

article iframe {
    max-width: 100%;
    height: auto;
}

.post-content div.npf_row {
    margin-bottom: calc(var(--gutter) - 4px);

    &:last-child {
        margin-bottom: 0;
    }

    .npf_col {
        margin-right: calc(var(--gutter) - 4px);

        &:last-child {
            margin-right: 0;
        }
    }
}

/* General photoset styling */
.npf_row:only-of-type,
.npf-photos,
.more_photoset {
    border-radius: var(--photo-corners);
    overflow: hidden;
}

/* Margin between figures */
figure:is(:not(:last-of-type)) {
    margin-bottom: var(--gutter);
}

/* Full-width figure rounding for NPF photos followed by figure */
.npf-photos:has(+figure) {
    border-radius: var(--photo-corners) var(--photo-corners) 0 0;
    max-width: fit-content;
}

.npf-photos + figure {
    overflow: hidden;
    border-radius: 0 0 var(--photo-corners) var(--photo-corners);
    margin: var(--gutter) 0;
    max-width: fit-content;
}

/* Figures containing linked photos */
figure:has(a.post_media_photo_anchor) {
    width: fit-content;
    max-width: 100%; /* keeps it responsive inside the container */
}

/* ----------------------------------------------------- LEGACY PHOTOSET */


/* Each photo-row and legacy-photoset-inner receives half
   of the gutter as padding. This ensures consistent spacing
   between photos, while the last element aligns with
   the outer container. 
   
   So we use calc(). gutter-width divided by 2. */


/* control of single legacy photo 
   and photoset border-radius */
.legacy-photo img,
.photoset {
    border-radius: var(--photo-corners);
    overflow: hidden;
}
.photo-row {
    padding: calc(var(--gutter) / 2) 0; 
    display: flex;

    &:first-child {
        padding-top: 0;
    }

    &:last-child {
        padding-bottom: 0;
    }
}
.legacy-photoset-inner {
    cursor: pointer;
    padding: 0 calc(var(--gutter) / 2); 
    flex-grow: 1;

    & .image {
        width: 100%;
        height: 100%;
        display: block;
        object-fit: cover;
    }

    &:first-child {
        padding-left: 0;
    }

    &:last-child {
        padding-right: 0;
    }
}
.photo-row-1 .legacy-photoset-inner { width: 100%; }
.photo-row-2 .legacy-photoset-inner { width: 50%; }
.photo-row-3 .legacy-photoset-inner { width: 33.3333333%; }

.photo-single {
    cursor: pointer;
}

/* The /mournstera-legacy-photoset.js script
   sets the photoset's `visibility` to visible
   once the layout is processed, preventing
   layout shifts or a "wonky" initial display. */
   
.photoset {
    visibility: hidden;
}

/* --------------------------------------------------- LINK STYLE IN POSTS */

/* I like to overide the global link styling of:

a {
    color:rgb(var(--color-link));
    text-decoration: none;
    overflow-wrap: anywhere;
    
    &:hover {
        color: rgb(var(--color-accent)); 
    }
}




*/
:where(
    .post-content p,
    .post-content ul,
    .post-content ol,
    .post-content blockquote,
    .sidebar-description,
    .updates
) a {
    text-decoration: underline;
    text-decoration-color: rgb(var(--color-accent));
    text-underline-offset: 2px;
    text-decoration-thickness: 1px;
}

/* Hover state for links in the same areas*/
:where(
    .post-content p,
    .post-content ul,
    .post-content ol,
    .post-content blockquote,
    .sidebar-description,
    .updates
) a:hover {
    color: rgb(var(--color-accent));
    text-decoration-color: rgb(var(--color-link));
}

/* Make sure that links inside spans inherit surrounding
   text color from the colors used in dashboard. This fix is
   only sometimes needed - it is depended on whether
   the user used one of the 3 choices in the Text Editor:
   
   - Rich text
   - HTML
   - Markdown
   
   The "correct parent is <a><span>text</span></a>
   however some use <span><a>text</a></span>
   which mess things up.
   
 */
 
.post-content span a {
    color: inherit;
}

/* "Read More" links/buttons */
.read_more {
    border-radius: var(--round1);
    padding: 0.8rem;
    background: rgb(var(--color-bg2));
    color: rgb(var(--color-text));
    font-weight: 500;
    text-decoration: none;
    border: 0.0625rem solid rgb(var(--color-border));

    &:hover {
        border-color: rgb(var(--color-accent));
    }
}

/* --------------------------------------------------- MISC STYLING FOR SPECIAL CONTENT */

/* Quirky paragraph style (npf_quirky) */
p.npf_quirky {
    line-height: inherit;
    font-size: 1.6em;
}

/* Preformatted text adjustments:
   - Resets whitespace to allow line breaks naturally
   - Removes default margins to fit post layout */
   
pre {
    white-space: initial;
    margin: 0;
}

/* Inline code styling:
   - Matches surrounding text size
   - Transparent background so it blends in
   - Allows long words or URLs to break naturally */
   
code {
    line-height: inherit !important;
    background: transparent;
    font-size: inherit !important;
    word-wrap: break-word;
}

/* ----------------------------------- ALT. DESCRIPTION (Tumblr Popovers) */

/* Overrides Tumblr's default popover styling:
   - Heavy use of !important to ensure custom theme colors and padding are applied
   - Makes popover content readable and visually consistent with the theme */

/* Tutorial popover wrapper */
.popover.tutorial {
    padding: var(--gap3)!important;
    background-color: rgb(var(--color-text))!important;
    color: rgb(var(--color-bg1))!important;
}

/* General popover wrapper:
   - Rounded corners
   - Inherit theme font
   - Removes Tumblr's default shadow */
.popover {
    border-radius: var(--round1)!important;
    font: inherit!important;
    box-shadow: none!important;
}

/* Tutorial popover content and title text colors */
.popover.tutorial .content,
.popover.tutorial .title {
    color: rgb(var(--color-bg1))!important;
}

/* Tutorial popover title:
   - Bold and slightly larger for emphasis */
.popover.tutorial .title {
    font-weight: 700!important;
    font-size: 1.2em!important;
}

/* Tutorial popover content:
   - Inherits font size from parent for consistency */
.popover.tutorial .content {
    font-size: inherit!important;
}

/* Tutorial popover "OK" button:
   - Matches theme colors
   - Cursor indicates clickable
   - Rounded and padded for visual balance and usability */
.popover.tutorial .ok_button {
    color: rgb(var(--color-text))!important;
    cursor: pointer!important;
    background: rgb(var(--color-bg1));
    padding: var(--gap1)!important;
    border-radius: var(--round1);
}

/* ----------------------------------------------------- POST FOOTER */
footer.post-footer {
    margin-top: var(--text-margin);
}
button.pinned {
    font-size: 1.45em;
    color: rgb(var(--color-accent));
}
.date {
    color: rgb(var(--color-text));
    
    &:hover {
        color: rgb(var(--color-accent));
    }
}
/* .info-item wrap (<a> links or <button> for toggle tags
   contains the note count/like/toggle tags/reblog + their icon */
.info-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
}
/*  LIKE BUTTON */
a.custom-like {
    position: relative;

    .like_button {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        z-index: 1;

        iframe {
            width: 100% !important;
            height: 100% !important;
        }
    }

    /* liked state */
    .liked + .info-like-icon,
    .liked + .info-like-icon svg {
        color: rgb(var(--color-accent)) !important;
        fill: currentColor;
    }

    .liked + .info-like-icon + .info-like-text {
        color: rgb(var(--color-text)) !important;
    }

    .liked + .info-like-icon + .info-like-text::after {
        content: 'd';
    }
}

/* ICONS */
.info-icon {
    font-size: 1.45em;
}

/* ICON-ONLY MODE */
html.info-only-icons {

    .info-right {
        gap: 0.8rem;

        a,
        .info-tags {
            color: rgb(var(--color-text));

            &:hover {
                color: rgb(var(--color-accent));
            }
        }
    }

    .info-text {
        display: none;
    }

    .info-icon {
        display: flex;
    }
}

/* TEXT-ONLY MODE */
html.info-only-text {

    .info-right {
        gap: 0.5rem;

        a, .info-tags {
            color: rgb(var(--color-text));

            &:hover {
                color: rgb(var(--color-accent));
            }
        }

        .info-item:not(:last-child)::after {
            content: '/';
            display: block;
            color: rgb(var(--color-border));
            margin-left: 0.5rem;
        }
    }

    .info-text {
        display: flex;
    }

    .info-icon {
        display: none;
    }
}

/* ICON + TEXT MODE */
html.info-both {

    .info-right {
        gap: var(--gap2);

        a, .info-tags {
            color: rgb(var(--color-text));

            &:hover {
                color: rgb(var(--color-accent));
            }
        }

        svg {
            color: rgb(var(--color-link));
        }
    }

    /* Refining liked post icon so only the icon is coloured.*/
    a.custom-like {

        .liked + .info-like-icon {
            color: rgb(var(--color-accent)) !important;
        }

        .liked + .info-like-icon svg {
            stroke: rgb(var(--color-accent)) !important;
        }

        .liked + .info-like-icon + .info-like-text {
            color: rgb(var(--color-text)) !important;
        }
    }
}



/*    TAGS (and toggle-button) */


.tags-container {
    width: 100%;
}
.tags {
    
    a {
        margin-right: var(--gap1);
        line-height: 1.7;
        color: rgb(var(--color-link));
        
        &:hover {
            color: rgb(var(--color-accent));
        }
    }
}

/*  TAG DISPLAY BEHAVIOR
   The <html> element has a { select:Tags } option, which outputs one of:
   - tags-always
   - tags-truncated
   - tags-hidden

   When "tags-hidden" is selected:
   
   - the .toggle-tags element becomes visible (acts as a button)
   - the .tags-container starts hidden (max-height: 0)
   
 */
 
  /* hidden unless 'tags-hidden' mode is active */
.toggle-tags {
    display: none;
}

html.tags-hidden .toggle-tags {
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;     /* visible when active */
}



html.tags-always {
    
    .toggle-tags {
        display: none;
    }
}

html.tags-hidden {
    
    .tags-container {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease;
    }
}
/* TRUNCATED */
/* if post has more than 3 tags, they are truncated and hidden behind
   a "See all" link - when pressed all are visible. Just like
   the dashboard. there is a JS script that handles this. */
html.tags-truncated {

    
    .tags-container {

            a.expand {
                font-weight: 500;
                margin-right: 0;
                color: rgb(var(--color-link));
            }
            a.visible {
                display: inline-block;
            }
            a.hidden {
                display: none;
            }
            .ellipsis {
                display: inline-block;
                text-overflow: ellipsis;
                white-space: nowrap;
                overflow: hidden;
                
                &:after {
                    content: '...';
            }
        }
    }
}

/*  PERMALINK PAGES */

footer.permalink-footer {
    border: 0.0625rem solid rgb(var(--color-border));
    background: rgb(var(--color-bg2));
    overflow: hidden;
    border-radius: var(--round2);
    margin-top: var(--gap5);
    padding: var(--text-margin);
    
    .tags {
        margin-top: var(--gap3);
    }
}

time.permalink-ago {
    font-weight: 700;
    font-size: 1.1em;
}
time.permalink-date {
    line-height: 1.6;
    margin: 0.6rem 0 var(--gap3) 0;
    display: flex;
    flex-direction: column;
    gap: var(--gap3);
    
    &::after {
        content: '';
        width: 30%;
        height: 0.0625rem;
        background: rgb(var(--color-border));
    }
}

.perma-wrap {
    margin-top: 0.6rem;

    span {
        font-weight: 700;

        &:after {
            content: ':';
            margin-right: 0.3rem;
        }
    }
}

.source-info {
    margin-top: var(--gap2);
    display: block;
}

/*  NOTES SECTION */

.perma-post-notes {
    margin-top: var(--gap4);
    border: 0.0625rem solid rgb(var(--color-border));
    overflow: hidden;
    border-radius: var(--round2);
    background: rgb(var(--color-bg2));
}

.perma-notes {
    display: block;
    font-weight: 600;
    border-bottom: 0.0625rem solid rgb(var(--color-border));
    padding: var(--gap2);
    text-align: center;
}

/* Notes list */
ol.notes {
    padding: var(--text-margin);
}

ol.notes li.note {
    padding: 0.5rem 0;
    position: relative;
}

ol.notes li.note:first-of-type {
    padding-top: 0;
}

ol.notes li.note:last-of-type {
    padding-bottom: 0;
}

/* Avatars inside notes */
ol.notes li.note img.avatar {
    margin-right: var(--gap1);
    vertical-align: middle;
    max-width: 2em;
    height: 2em;
    border-radius: var(--round1);
}

/* "More notes" link */
a.more_notes_link {
    color: rgb(var(--color-text));
    display: block;
    font-weight: 500; 
}


/* ----------------------------------------------------- TAG/SEARCH PAGES */
.results-summary {
    text-align: center;
    margin-bottom: var(--gap5);
    border: 0.0625rem solid rgb(var(--color-border));
    background: rgb(var(--color-bg2));
    overflow: hidden;
    border-radius: var(--round2);
    padding: var(--text-margin);
}
/* ------------------------------------------------------- POST-TYPE: poll */
.poll-post a.poll-row {
    color: rgb(var(--color-text));
    line-height: inherit !important;
    font-size: var(--font-size);
    border-radius: var(--round1);
    padding: 0.8rem var(--gap1);
    font-weight: 600;
    border: 0.0625rem solid rgb(var(--color-border));
    background-color: rgb(var(--color-bg2));
    width: auto!important;
    text-align: center;
    min-height: auto;
}

.poll-post a.poll-row:hover {
    color: rgb(var(--color-accent))!important;
}
a.poll-row p {
    margin: 0!important;
}
.poll-post .poll-see-results {
    margin-top: 0;
    margin-bottom: var(--text-margin);
}
/* -------------------------------------------------------- POST-TYPE: ask */

.ask-block {
    border: 0.0625rem solid rgb(var(--color-border));
    background: rgb(var(--color-bg1));
    overflow: hidden;
    border-radius: var(--round2);
    margin: var(--text-margin);
}
header.ask-header {
    display: flex;
    align-items: center;
    gap: var(--gap2);
    padding: var(--text-margin);
    border-bottom: 0.0625rem solid rgb(var(--color-border));

    img.ask-avatar {
        width: 3.5em;
        height: 3.5em; 
        border-radius: var(--round1);
    }

.ask-user {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;

        a {
            color: rgb(var(--color-text));
            text-decoration: none;

            &:hover {
                color: rgb(var(--color-accent));
            }
        }

        .ask-username {
            font-weight: 700;
            text-transform: lowercase;
        }
    }
}

.question {
    border-bottom: 0.0625rem solid rgb(var(--color-border));
}

/* handles photoset in answered asks, but skips inline images in ask/answers */
:where(.ask-body) img {
    width: auto !important;
    max-width: 100%;
    border-radius: var(--photo-corners);
}

/* ------------------------------------------------------- POST-TYPE: chat */
p.npf_chat span.label {
    font-weight: 600;
}
p.npf_chat {
    font-family: inherit!important;
}
/* --------------------------------- POST-TYPE: video/some audio responsiveness */

article iframe:not(
    iframe.bandcamp_audio_player,
    .spotify_audio_player,
    iframe.soundcloud_audio_player,
    iframe.tumblr_audio_player,
    iframe[src*="instagram.com"]
) {
    max-width: 100%;
    aspect-ratio: 16/9;
    height: auto;
    display: block;
}
figure.tmblr-embed iframe.embed_iframe[src*="instagram.com"] {
    height: revert-layer !important;
    aspect-ratio: auto !important;
    width: 100% !important;
}
iframe.soundcloud_audio_player,
.tumblr_video_container {
    width: 100%!important;
    height: auto!important;
}

figure iframe.spotify_audio_player,
iframe.spotify_audio_player {
    max-height: 80px;
    width: 100%;
}

article iframe[src*='soundcloud'] {
    max-height: 130px;
}

figure iframe.bandcamp_audio_player {
    max-height: 120px;
}

figure.tmblr-full video {
    display: block;
}

/* -----------------------------------------------------  POST TYPE: audio */
/* .audio-caption is set as flex by tumblr as default, but we need it to be display block */
.tmblr-full > .audio-caption {
    display: block !important;
}
/* wrapper for entire audio post */
figcaption.audio-caption {
    background: white;
    border: 0.0625rem solid rgb(var(--color-border));
    border-radius: var(--round1);
    background: rgb(var(--color-bg1));
}
/* wrapper for button, audio details and album */
.audio-info {
    display: flex;
    align-items: center;
    gap: var(--gap3);
    padding: var(--text-margin);
}
/* audio text (album title, etc.) */
.tmblr-full > .audio-caption .audio-details {
    max-width: 100%;
    padding: 0; /* remove tumblr default padding */
    flex: auto;
}
/* album cover */
.tmblr-full > .audio-caption .album-cover {
    width: 5rem;
    height: 5rem;
    border-radius: var(--round1);
    object-fit: cover;
}
/* plauy-pause button wrapper */
.custom-audio-player-container .play-pause {
    display: flex;
}
/* plauy-pause svg */
.custom-audio-player-container .play-pause svg {
    width: 2.2em;
    height: 2.2em;
    color: rgb(var(--color-accent));
}
/* Tumblr has a 1.2em on artist text, resetting it here */
.tmblr-full > .audio-caption .album,
.tmblr-full > .audio-caption .artist {
    font-size: 1em;
    line-height: 1.5;
}
/* wrapper for progress bar and time display */
.progress-bar-container {
    display: flex;
    align-items: center;
    gap: var(--gap3);
    border-top: 0.0625rem solid rgb(var(--color-border));
    padding: var(--gap3);
}

/* Style the progress bar track (actually it's range input itself but it's only for chrome) */
.progress-bar {
    width: 100%;
    height: 0.625rem;
    -webkit-appearance: none; /* removes the default styling in most browsers */
    background: rgb(var(--color-bg2));
    border-radius: var(--round1);
    border: 0.0625rem solid rgb(var(--color-border));
}

/* Style the track for both WebKit and Mozilla browsers */
.progress-bar::-webkit-slider-runnable-track,
.progress-bar::-moz-range-track {
    width: 100%;
    height: 0.625rem;
    background: rgb(var(--color-bg2));
    border-radius: var(--round1);
    border: 0.0625rem solid rgb(var(--color-border));
}

/* Style the thumb for WebKit (Chrome, Safari, etc.) */
.progress-bar::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 1.2em;
    height: 1.2em;
    background: rgb(var(--color-accent));
    border-radius: 50%;
    cursor: pointer;
}

/* Style the thumb for Mozilla (Firefox) */
.progress-bar::-moz-range-thumb {
    width: 1.2em;
    height: 1.2em;
    background: rgb(var(--color-accent));
    border: 0; /* remove weird border in firefox */
    border-radius: 50%;
    cursor: pointer;
}
/* style MM:SS time count */
.time-display {
    flex-shrink: 0;
}

/* ------------------------------------------------------  POST TYPE: link */
.custom-link-block {
    
}

a.link-header {
    display: flex;
    flex-direction: row;
    align-items: center;
    background: rgb(var(--color-accent));
    color: rgb(var(--color-bg1));
    padding: var(--text-margin);
    justify-content: space-between;
    border-radius: var(--round1) var(--round1) 0 0;
    
    &:not(:has(+ .link-description)) {
        border-radius: var(--round1);
    }

    svg.link-icon {
        --arrow-gap: var(--gap5); /* space between text and arrow */
        flex-shrink: 0;
        stroke-width: 3.2;
        width: 1.8em;
        height: 1.8em;
        margin-left: var(--arrow-gap);
        transition: margin 0.15s ease;
    }

    .link-title-wrap {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.4rem;

        span.link-title {
            font-size: 1.3em;
            line-height: 1.5;
            font-weight: 700;
        }
        span.site-url {
            font-size: 0.9em;
            text-transform: uppercase;
        }
    }

    &:hover svg.link-icon {
        margin-left: var(--arrow-gap);
        margin-right: -0.6rem;
    }
}

p.link-description {
    background: rgb(var(--color-bg1));
    border: 0.0625rem solid rgb(var(--color-border));
    border-top: 0;
    padding: var(--text-margin);
    border-radius: 0 0 var(--round2) var(--round2);
}

/* ----------------------------------------------------- RIGHT CORNER CONTENT */
.corner-controls {
    position: fixed;
    display: flex;
    gap: var(--gap1);
    flex-direction: column;
    align-items: flex-end;
    z-index: 2;
    right: var(--gap3);
}

.corner-controls.top {
    top: var(--gap3);
}
.corner-controls.bottom {
    bottom: var(--gap3);
}
/* all "buttons" in corner top/bottom*/
.corner-button {
    display: inline-flex;
    color: rgb(var(--color-text));
    background: rgb(var(--color-bg2));
    border: 0.0625rem solid rgb(var(--color-border));
    border-radius: var(--round1);
    padding: 0.375rem;
    font-size: 1.4em;
}
    
/*  tumblr controls*/
iframe.tmblr-iframe,  
.tmblr-iframe {
    z-index: 999 !important;
    transform: scale(0.84);
    transform-origin: 100% 0;
    transition: all 0.3s ease;
    opacity: 0;
    visibility: hidden;
    top: 10px;
    right: 50px;
}
.tmblr-iframe.active {
    opacity: 1;
    visibility: visible;
}

.spin {
    transition: rotate 0.3s ease;
    display: inline-flex;
}
.spin.active {
    rotate: 30deg;
}


/*  updates tab */
.updates-container {
    flex-direction: column;
    display: flex;
    align-items: flex-end;
    gap: var(--gap1);

}

button.update-toggle .upd-icon.hidden {
    display: none;
}
.updates {
    padding: var(--gap3);
    border-radius: var(--round1);
    background: rgb(var(--color-bg2));
    border: 0.0625rem solid rgb(var(--color-border));
    transition: visibility 0.5s ease, opacity 0.5s ease, transform 0.5s ease;
    opacity: 0;
    visibility: hidden;
}

.updates.active {
    opacity: 1;
    visibility: visible;
}

.updates-inner {
    width: 12rem;
    max-height: 13rem;
    overflow-x: hidden;
    overflow-y: auto;
    line-height: 1.5;
}

@supports selector(::-webkit-scrollbar) {
    .updates-inner::-webkit-scrollbar {
        width: 4px;
        height: 4px;
    }
    .updates-inner::-webkit-scrollbar-track {
        background-clip: padding-box;
        background-color: rgb(var(--color-bg2));
        border-left: 0;
    }
    .updates-inner::-webkit-scrollbar-thumb {
        background-color: rgb(var(--color-accent));
    }
    .updates-inner::-webkit-scrollbar-button {
        display: none;
    }
    .updates-inner::-webkit-scrollbar-corner {
        background-color: rgb(var(--color-bg2));
    }
}

@-moz-document url-prefix() {
    .updates-inner {
        scrollbar-width: thin;
        scrollbar-color: rgb(var(--color-accent)) rgb(var(--color-bg2));
    }
}
/* if update-text has activity div below,
   then: .activity gets this */
.update-text + .activity {
    margin-top: var(--gap3);
}

.activity {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.3rem;
    
    &:last-child {
        margin-bottom: 0;
    }
    .activity-icon {
        font-size: 1.2rem;
    }
    &:hover {
        .activity-icon {
            color: rgb(var(--color-accent));
        }
    }
}

/* SCROLL TO TOP & CREDIT LINK*/
.bottom-corner {
    position: fixed;
    bottom: var(--gap3);
    right: var(--gap3);
    z-index: 80;
}
button.scroll-to-top {
    color: rgb(var(--color-text), 0.3);
    cursor: default;

    &.visible {
        cursor: pointer;
        color: rgb(var(--color-text));
    }
}
/* ---------------------------------------------------------MEDIA QUERIES */

/* LEFT/RIGHT SIDEBAR MARGINS */

/* Remove left/right post margins on small screens.
   The calc() sums post width + 2 x sidebar width + 2 x layout gap + buffer
   to match the margins applied in html.left/html.right and cancel them
   when the viewport is too narrow. */

@media only screen and (max-width: calc({select:post width} + {select:Sidebar Width} + {select:Sidebar Width} + {select:Layout Gap} + {select:Layout Gap} + 3rem)) {

    html.left main, html.right main {
        margin-right: 0;
        margin-left: 0;
    }
}


/* 
   When the viewport/screen size  is smaller than the combined width of:
   - post width
   - sidebar width
   - layout gaps
   - plus a small 3rem buffer
   We switch the <main> layout to a stacked layout so the sidebar 
   moves above or below the post for narrow screens.
*/
@media only screen and (max-width: calc({select:post width} + {select:Sidebar Width} + {select:Layout Gap} + 3rem)) {
    
    :root {
        --sidebar-width: var(--post-width);
    }
    
    html.left main, html.right main {
        grid-template-areas: "sb" "post";
    }
    
    .left,.right {
        aside {
            width: var(--post-width); /* make the sidebar the same width as post */
        }
        .sidebar-inner {
            position: unset; /* disable sticky/fixed positioning */
            top: unset;
        }
    }

    .mobile {
        display: block; /* show mobile-specific elements */
    }
    .desktop {
        display: none!important; /* hide desktop-specific elements */
    }
}


/* When the viewport/screen size is smaller than the user-set post-width */
@media only screen and (max-width: calc({select:post width} + 3rem)) {
    :root {
        --post-width: 88vw;
    }
}

/* 
   Definite mobile: 
   For very small screens (<425), hide controls and iframes
   since that's not useful for mobile view.
*/
@media only screen and (max-width: 425px) {
    button.controls,
    iframe.tmblr-iframe,
    .tmblr-iframe { 
        display:none;
    }
}

/* 
   Accessibility: 
   Respect user' reduced motion preferences.
   Any element with animation or very long transition,
    will have its animation disabled if the user has
    enabled reduced motion on their device/computer.
*/
@media (prefers-reduced-motion: reduce) {
    .your-class-here {
        animation: none !important;
    }
}

{CustomCSS}
</style>
</head>

<body>

<div class="page-container">

<main>

    <aside>
        <div class="sidebar-inner">


            <!-- If { image:Dark mode Sidebar } is not uploaded, just show { image:Sidebar } -->
            {block:IfSidebarImage}
                <div class="sidebar-image {select:Sidebar Image Shape} flex" aria-hidden="true">
                    <img {block:IfDarkModeSidebarImage}class="mode-light"{/block:IfDarkModeSidebarImage} src="{image:Sidebar}" alt="Sidebar image"/>
                    {block:IfDarkModeSidebarImage}
                        <img class="mode-dark" src="{image:Dark mode Sidebar}" alt="Sidebar dark mode image"/>
                    {/block:IfDarkModeSidebarImage}
                </div>
            {/block:IfSidebarImage}

            {block:ifSidebarTitle}
                <h3 class="sidebar-title">{text:Sidebar Title}</h3>
            {/block:ifSidebarTitle}
            
            {block:ifSidebarDescription}
                <div class="sidebar-description">{text:Sidebar Description}</div>
            {/block:ifSidebarDescription}
            
            {block:ifSearchBar}
            <form class="search flex between align-center gap1" role="search" action="/search" method="get" aria-label="Search the blog">
                <label for="search-input" class="visually-hidden">Search the blog</label>
                <button class="search" aria-label="search" type="submit">
                    <i class="ph-bold ph-magnifying-glass"></i>
                </button>
                <input id="search-input" type="text" name="q" value="{SearchQuery}" placeholder="Search" autocomplete="off" />
            </form>
            {/block:ifSearchBar}
            
        <!-- NAVIGATION START -->
    
            <!--Typically, a navigation menu would use <ul> and <li> elements
            inside a <nav>. Here, we simplify the structure for flexibility
            and easier customization. We use role="list" on the <nav> and
            role="listitem" on each link to maintain accessibility. This
            approach allows you to remove or restructure the menu without
            breaking the theme, while keeping screen readers happy.-->
        
            <!-- NAVIGATION: no toggle -->
            {block:ifNotToggleLabel}
            <nav class="menu flex gap1 align-center wrap" aria-label="Primary navigation" role="list">
                <a href="{BlogURL}" role="listitem">{text:Home Link Label}</a>
            
                {block:AskEnabled}
                    {block:ifAskLinkLabel}
                        <a href="/ask" role="listitem">{text:Ask Link Label}</a>
                    {/block:ifAskLinkLabel}
                {/block:AskEnabled}
            
                {block:HasPages}
                    {block:Pages}
                        <a href="{URL}" role="listitem">{Label}</a>
                    {/block:Pages}
                {/block:HasPages}
            
                {block:ifArchiveLinkLabel}
                    <a href="/archive" role="listitem">{text:Archive Link Label}</a>
                {/block:ifArchiveLinkLabel}
            
                {block:SubmissionsEnabled}
                    {block:ifSubmitLinkLabel}
                        <a href="/submit" role="listitem">{text:Submit Link Label}</a>
                    {/block:ifSubmitLinkLabel}
                {/block:SubmissionsEnabled}
            </nav>
            {/block:ifNotToggleLabel}
            
            <!-- NAVIGATION: toggle -->
            {block:ifToggleLabel}
            <!-- Toggle navigation -->
            <nav class="menu-toggle flex align-center gap1 wrap" aria-label="Primary navigation" role="list">
                <a href="{BlogURL}" role="listitem">{text:Home Link Label}</a>
                {block:AskEnabled}
                    {block:ifAskLinkLabel}
                        <a href="/ask" role="listitem">{text:Ask Link Label}</a>
                    {/block:ifAskLinkLabel}
                {/block:AskEnabled}
                <button class="sub-toggle flex align-center gap1" aria-expanded="false" aria-controls="submenu-container">
                    <span>{text:Toggle Label}</span>
                    <span class="nav-spin" aria-hidden="true"><i class="ph ph-caret-down"></i></span>
                </button>
            </nav>
            
            <!-- Submenu -->
            <!-- The ID "submenu" is required so the toggle button's
            aria-controls can reference this container for accessibility -->
            <div id="submenu-container" aria-label="Secondary navigation">
                <nav class="submenu flex gap1 wrap" role="list" hidden="true">
                    {block:HasPages}
                        {block:Pages}
                            <a href="{URL}" role="listitem">{Label}</a>
                        {/block:Pages}
                    {/block:HasPages}
                    {block:ifArchiveLinkLabel}
                        <a href="/archive" role="listitem">{text:Archive Link Label}</a>
                    {/block:ifArchiveLinkLabel}
                    {block:SubmissionsEnabled}
                        {block:ifSubmitLinkLabel}
                            <a href="/submit" role="listitem">{text:Submit Link Label}</a>
                        {/block:ifSubmitLinkLabel}
                    {/block:SubmissionsEnabled}
                </nav>
            </div>
            {/block:ifToggleLabel}
        <!-- NAVIGATION END -->
            
            {block:ifFeaturedTags}
                <nav class="featured-tags flex gap2 wrap" aria-label="Featured tags">
                    {block:HasPages}
                        {block:Pages}
                                <a href="{URL}">
                                    <span class="tagname">{Label}</span>
                                    <span class="total"></span>
                                </a>
                        {/block:Pages}
                    {/block:HasPages}
                </nav>
            {/block:ifFeaturedTags}
            
        </div>
    </aside>
    <!--SIDEBAR END-->

    <section>

    {block:TagPage}
        <!-- Search/Tag/Day Results Info
             Displays a summary message about the current page:
             - TagPage: number of posts for this tag (or "No results")
             - SearchPage: number of results for a search query (or fallback message)
             - DayPage: shows everything posted on a specific date
             This is shown above the post list to give context to the user.
        -->
        <div class="results-summary">
            {lang:Showing TagResultCount posts tagged Tag 3}
            {block:NoTagPage}No results.{/block:NoTagPage}
        </div> 
    {/block:TagPage}
    
    {block:SearchPage}
        <div class="results-summary">
            {lang:Showing SearchResultCount results for SearchQuery 2}
            {lang:Sorry no results for SearchQuery}
        </div>
    {/block:SearchPage}
    
    {block:DayPage}
        <div class="results-summary">
            {lang:Viewing everything posted on Month DayOfMonth Year}
        </div>
    {/block:DayPage}

        <!--
           { block:Posts } block with inlineMediaWidth / inlineNestedMediaWidth attributes:
           
           - Unlike a plain { block:posts }, this ensures that inline images
             and nested media in posts display correctly up to the specified width.
           - Important for full-size images in posts without breaking layout.
           - Note: Tumblr’s editor will not highlight this as a "“"valid block"
             but it works as expected and should not be replaced with a plain { block:posts }.
        -->
        {block:posts inlineMediaWidth="1280" inlineNestedMediaWidth="1280"}

        <article id="post-{PostID}" class="{posttype}-post posts" role="article" aria-labelledby="post-title-{PostID}">
            
            
            <!-- .post-content BEGINS -->
            <div class="post-content">

                {block:Photo}
                <!-- legacy single photo -->
                    <a class="legacy-photo photo-single"  onclick="Tumblr.Lightbox.init([{ width: {PhotoWidth-HighRes}, height: {PhotoHeight-HighRes}, low_res: '{PhotoURL-500}', high_res: '{PhotoURL-HighRes}' }]); $('body').toggleClass('tumblr_lightbox_active'); return false"><img src="{PhotoURL-HighRes}"></a>
                {/block:Photo}

                {block:Photoset}
                <!-- legacy photoset -->
                    <div class="photoset" data-layout="{PhotosetLayout}">
                        {block:Photos}
                            <div class="legacy-photoset-inner" 
                                data-width="{PhotoWidth-HighRes}" 
                                data-height="{PhotoHeight-HighRes}" 
                                data-lowres="{PhotoURL-500}" 
                                data-highres="{PhotoURL-HighRes}">
                                <img src="{PhotoURL-HighRes}" alt="{PhotoAlt}" class="image"/>
                            </div>
                        {/block:Photos}
                    </div>
                {/block:Photoset}

                {block:Quote}
                <!-- legacy quote (styled as npf) -->
                    <div class="caption">
                        <p class="npf_quote">{Quote}</p>
                        {block:Source}
                            <p class="source">-{Source}</p>
                        {/block:Source}
                    </div>
                {/block:Quote}

                {block:Chat}
                <!-- legacy chat (styled as npf) -->
                    <div class="caption">
            	        {block:Lines}
            	        <p class="npf_chat">
            		        {block:Label}
            		        <span class="label">{Label}</span>
            		        {/block:Label}
            		        {Line}
            	        </p>
            	        {/block:Lines}
                    </div>
                {/block:Chat}

                {block:link}
                    <!-- legacy link (npf+legacy styled JS manip) -->
                    <div class="custom-link-block">
                        <a {Target} href="{URL}" class="link-header">
                            <div class="link-title-wrap">
                                <span class="link-title">{Name}</span>
                                {block:Host}
                                    <span class="site-url" aria-label="Host: {Host}">{Host}</span>
                                {/block:Host}
                            </div>
                            <svg class="link-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                        </a>
                        {block:Excerpt}
                            <p class="link-description">{Excerpt}</p>
                        {/block:Excerpt}
                    </div>
                {/block:link}

                {block:Video}
                <!-- legacy video -->
                    <div class="video">
                        {Video-700}
                    </div>
                {/block:Video}

                {block:Audio}
                    <!-- legacy audio -->
                    
                    <!--I have installed my plugin to unify legacy and NPF audio posts.
                    read more here:
                    https://github.com/flipsewtf/Tumblr/tree/main/Plugins/UnifyAudio-->
                    
                    <figure class="tmblr-full">
                        <figcaption class="audio-caption legacy">
                            <div class="audio-info">
                                <span class="tmblr-audio-meta audio-details">
                                    {block:TrackName}<span class="tmblr-audio-meta title">{TrackName}</span>{/block:TrackName}
                                    {block:Artist}<span class="tmblr-audio-meta artist">{Artist}</span>{/block:Artist}
                                    {block:Album}<span class="tmblr-audio-meta album">{Album}</span>{/block:Album}
                                </span>
                                {block:AlbumArt}<img class="album-cover" src="{AlbumArtURL}" alt="image"/>{/block:AlbumArt}
                            </div>
                        </figcaption>
                        {block:AudioPlayer}{AudioPlayer}{/block:AudioPlayer}
                    </figure>
                {/block:Audio}

                {block:Answer}
                    <!-- Ask post -->
             
                        <!-- Question -->
                        <div class="ask-block ask-question">
                            <header class="ask-header">
                                <img class="ask-avatar" src="{AskerPortraitURL-48}" alt="Avatar of ansker">
                                <div class="ask-user">
                                    <span id="asker-{PostID}" class="ask-username">{Asker}</span>
                                    <span class="ask-label">Sent a message</span>
                                </div>
                            </header>
                            <div class="ask-body">
                                {Question}
                            </div>
                        </div>
                
                        <!-- Direct answer -->
                        {block:NotReblog}
                            <div class="caption ask-answer">
                                {Answer}
                            </div>
                        {/block:NotReblog}
                
                        <!-- Reblogged answer -->
                        {block:Answerer}
                            <div class="ask-block ask-answer-reblog">
                                <header class="ask-header">
                                    <img class="ask-avatar" src="{AnswererPortraitURL-48}" alt="Avatar of answerer">
                                    <div class="ask-user">
                                        <span class="ask-username">{Answerer}</span>
                                        <span class="ask-label">Answered</span>
                                    </div>
                                </header>
                                <div class="ask-body">
                                    {Answer}
                                </div>
                            </div>
                        {/block:Answerer}

                {/block:Answer}

                
                
                <!--caption / and text posts -->
                
                <div class="caption {block:notreblog}original-post{/block:notreblog}">
                <!-- caption -->
                    {block:Text}
                        {block:Title}<h1 id="post-title-{PostID}">{Title}</h1>{/block:Title}
                    {/block:Text}

                    {block:Link}
                        {block:Description}
                        {block:NotReblog}{Description}{/block:NotReblog}
                        {/block:Description}
                    {/block:Link}
                    
                    {block:notreblog}
                    {block:caption}{Caption}{/block:caption}

                    {block:Text}<!-- 'reblog-content original' needed for
                    secondary photosets in npf to wrap properly in its own div -->
                        <div class="reblog-content original">{Body}</div>
                    {/block:Text}
                    
                    {/block:notreblog}
                    
                    {block:Rebloggedfrom}
                        {block:Reblogs}
                        
                        <!-- display:none; below hides the double comments that sometimes appear in old pre-2014 reblogged quote posts --> 
                        <div class="reblogs" {block:Quote}style="display:none;"{/block:Quote}>
                            <div class="reblog-header {block:IsOriginalEntry}original{/block:IsOriginalEntry} flex gap1 align-center">
                                <img src="{PortraitURL-64}" alt="{username}'s avatar">
                                {block:IsActive}
            			        <a class="user flex align-center" target="_blank" href="{Permalink}">{Username}</a>
            			        {/block:IsActive}
            			        {block:IsDeactivated}
            		            <span class="user deactivated" title="Deactivated" aria-label="User is deactivated">{Username}</span>
            			        {/block:IsDeactivated}
                            </div>
                            
                            <div class="reblog-content">
                                {Body}
                            </div>
                        </div>
                        {/block:Reblogs}
                    {/block:RebloggedFrom}
                </div>
        
            </div><!-- .post-content END -->
             
             
             
             <!-- always wrap content that is only meant for dated stuff in { block:Date } so username.tumblr.com/about-me does not have a footer-->
             
            {block:Date}

                {block:IndexPage}
                <!-- footer for index-->
                    <footer class="post-footer" aria-label="Post details">
                        <div class="info-inner flex gap2 align-center between">
                            
                            <!--pinned and date -->
                            <div class="info-left flex gap1 align-center">
                                {block:PinnedPostLabel}
                                        <button class="pinned" title="{PinnedPostLabel}" aria-label="{PinnedPostLabel}">
                                            <i class="ph-fill ph-bookmark-simple"></i>
                                        </button>
                                {/block:PinnedPostLabel}
                                <a class="date" href="{Permalink}" title="{DayOfMonth} {Month} {Year}" aria-label="Posted on {DayOfMonth} {Month} {Year}">
                                    <time datetime="{Year}-{MonthNumberWithZero}-{DayOfMonthWithZero}">{Month} {DayOfMonth}</time>
                                </a>
                            </div>
                            
                            <!-- note, tag toggle, like, reblog -->
                            <div class="info-right flex wrap align-center">

                                <a class="info-item" href="{Permalink}#note" title="{NoteCountWithLabel}">
                                    <span class="info-icon" aria-hidden="true"><i class="ph ph-chat-circle"></i></span>
                                    <span class="info-text notecount" aria-label="{NoteCountWithLabel}">{NoteCount}</span>
                                </a>
                                {block:HasTags}
                                    <button class="toggle-tags info-item info-tags" type="button" aria-label="Show or hide tags" aria-expanded="false" aria-controls="tags-container-{PostID}">
                                        <span class="info-icon" aria-hidden="true"><i class="ph ph-tag"></i></span>
                                        <span class="info-text">Tags</span>
                                    </button>
                                {/block:HasTags}
                                <a class="info-item custom-like like-tooltip" href="#" aria-label="Like this post">
                                    {LikeButton}
                                    <span class="info-icon info-like-icon"><i class="ph ph-heart-straight"></i></span>
                                    <span class="info-text info-like-text">Like</span>
                                </a>
                                <a class="info-item info-reblog rb-tooltip" href="{ReblogURL}" target="_blank" aria-label="Reblog this post">
                                    <span class="info-icon"><i class="ph ph-arrows-clockwise"></i></span>
                                    <span class="info-text">Reblog</span>
                                </a>
                            </div>
                        </div>
                        
                        {block:HasTags}
                            <div class="tags-container" id="tags-container-{PostID}">
                                <div class="tags" aria-label="Post tags" role="list">
                                    {block:Tags}
                                    <a href="{TagURL}" role="listitem">#{Tag}</a>
                                    {/block:Tags}
                                </div>
                                <div class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
                            </div>
                        {/block:HasTags}
                    </footer>
                {/block:IndexPage}
                
                
                {block:PermalinkPage}
                <!-- footer for permalink. example: url.tumblr.com/post/697631004545 -->
                    <footer class="permalink-footer" aria-label="Post details">
                    
                            <!-- Time ago -->
                            <time class="permalink-ago" datetime="{Year}-{MonthNumberWithZero}-{DayOfMonthWithZero}T{Hour24}:{Minutes}:00" aria-label="Posted on {Month} {DayOfMonth}, {Year} at {12Hour}:{Minutes} {CapitalAmPm}">
                                {TimeAgo}
                            </time>
                    
                            <!-- Full date/time -->
                            <time class="permalink-date" datetime="{Year}-{MonthNumberWithZero}-{DayOfMonthWithZero}T{Hour24}:{Minutes}:00" aria-label="{Month} {DayOfMonth}, {Year} at {12Hour}:{Minutes} {CapitalAmPm}">
                                {Month} {DayOfMonth}, {Year} at {12Hour}:{Minutes} {CapitalAmPm}
                            </time>

                            <!-- Reblog info -->
                            {block:RebloggedFrom}
                            <div class="perma-wrap reblog-info">
                                <span class="label">Created by</span>
                                <a href="{ReblogRootURL}">{ReblogRootName}</a> 
                            </div>
                    
                            <div class="perma-wrap reblog-source">
                                <span class="label">Reblogged from</span>
                                <a href="{ReblogParentURL}">{ReblogParentName}</a>
                            </div>
                            {/block:RebloggedFrom}
                    
                            <!-- Original source -->
                            {block:ContentSource}
                            <div class="perma-wrap source-info">
                                <span class="label">Source</span>
                                <a href="{SourceURL}">{SourceTitle}</a>
                            </div>
                            {/block:ContentSource}
                    
                            <!-- Tags -->
                            {block:HasTags}
                                <div class="tags" aria-label="Post tags" role="list">
                                    {block:Tags}
                                        <a href="{TagURL}" role="listitem">#{Tag}</a>
                                    {/block:Tags}
                                </div>
                            {/block:HasTags}

                    
                    </footer>
                {/block:PermalinkPage}

            {/block:Date}
        </article>
        
        {block:PostNotes}
            <section id="note" class="perma-post-notes" aria-labelledby="notes-heading">
                <h2 id="notes-heading" class="visually-hidden">Post notes</h2>
                <div class="perma-notes">{NoteCountWithLabel}</div>
                {PostNotes-64}
            </section>
        {/block:PostNotes}
        
        {/block:Posts}<!-- End post tumblr block -->
 
        {block:DayPagination}
        <nav class="pagi flex gap2 align-center between" role="navigation" aria-label="Pagination">
        
            <!-- Next Day Link -->
            <a 
                {block:NextDayPage} href="{NextDayPage}" aria-label="Next day {DayOfMonth} {Month}, {Year}" {/block:NextDayPage} 
                class="flex align-center gap2 {block:NextDayPage}has_{/block:NextDayPage}page" 
                {block:NoNextDayPage} aria-disabled="true" tabindex="-1" {/block:NoNextDayPage}>
                <span class="pagi-icon" aria-hidden="true">
                    <i class="ph-bold ph-arrow-left"></i>
                </span>
                {block:NextDayPage}
                    <span>{DayOfMonth} {Month} {Year}</span>
                {/block:NextDayPage}
            </a>
        
            <!-- Previous Day Link -->
            <a 
                {block:PreviousDayPage} href="{PreviousDayPage}" aria-label="Previous day {DayOfMonth} {Month}, {Year}" {/block:PreviousDayPage} 
                class="flex align-center gap2 {block:PreviousDayPage}has_{/block:PreviousDayPage}page" 
                {block:NoPreviousDayPage} aria-disabled="true" tabindex="-1" {/block:NoPreviousDayPage}>
                {block:PreviousDayPage}
                    <span>{DayOfMonth} {Month} {Year}</span>
                {/block:PreviousDayPage}
                <span class="pagi-icon" aria-hidden="true">
                    <i class="ph-bold ph-arrow-right"></i>
                </span>
            </a>
        
        </nav>
        {/block:DayPagination}
        
        {block:Pagination}
        <nav class="pagi flex gap5 align-center centered" role="navigation" aria-label="Pagination">
        
            <!-- Previous Page Link -->
            <a 
                {block:PreviousPage} href="{PreviousPage}" title="Newer posts" aria-label="Newer posts" {/block:PreviousPage} 
                class="{block:PreviousPage}has_{/block:PreviousPage}page" 
                {block:NoPreviousPage} aria-disabled="true" tabindex="-1" {/block:NoPreviousPage}>
                <span class="pagi-icon" aria-hidden="true">
                    <i class="ph-bold ph-arrow-left"></i>
                </span>
            </a>
        
            <!-- Next Page Link -->
            <a 
                {block:NextPage} href="{NextPage}" title="Older posts" aria-label="Older posts" {/block:NextPage} 
                class="{block:NextPage}has_{/block:NextPage}page" 
                {block:NoNextPage} aria-disabled="true" tabindex="-1" {/block:NoNextPage}>
                <span class="pagi-icon" aria-hidden="true">
                    <i class="ph-bold ph-arrow-right"></i>
                </span>
            </a>
        
        </nav>
        {/block:Pagination}

    </section>
</main>

<footer class="footer-bottom">
    Powered by <a target="_blank" href="https://www.tumblr.com/">Tumblr</a>.
</footer>

</div> <!-- END PAGE-CONTAINER (.page-container) -->

<div class="corner-controls top">
    <button class="tumblr-controls corner-button" title="Tumblr controls" type="button" aria-label="Open Tumblr controls">
        <span class="spin">
            <i class="ph ph-gear"></i>
        </span>
    </button>
    
    <!-- aria-label="" is updated dynamically via the JS: Enable light mode/Enable dark mode-->
    <button class="theme-toggle corner-button" aria-label="" type="button" role="button">
        <i class="ph ph-sun mode-light"></i>
        <i class="ph ph-moon mode-dark"></i>
    </button>
    
    {block:ifUpdateTab}
        <!--aria-controls="updates" needs to match the id="updates". aria-controls="Open update tab" is updated dynamically -->
        <div class="updates-container">
            <button class="update-toggle corner-button" type="button" aria-expanded="false" aria-controls="Open update tab" aria-label="">
                <i class="ph ph-bell upd-icon"></i>
                <i class="ph ph-bell-slash upd-icon hidden"></i>
            </button>
            <div id="updates" class="updates" role="region" aria-label="Update tab" aria-hidden="true" tabindex="-1">
                <div class="updates-inner">
                    {block:ifUpdateText}
                        <div class="update-text">
                            {text:Update Text}
                        </div>
                    {/block:ifUpdateText}
        
                    {block:ifActivity1}
                        <div class="activity">
                            {block:ifActivity1Icon}
                                <i class="ph-light ph-{text:Activity 1 Icon} activity-icon"></i>
                            {/block:ifActivity1Icon}
                            <span>{text:Activity 1}</span>
                        </div>
                    {/block:ifActivity1}
        
                    {block:ifActivity2}
                        <div class="activity">
                            {block:ifActivity2Icon}
                                <i class="ph-light ph-{text:Activity 2 Icon} activity-icon"></i>
                            {/block:ifActivity2Icon}
                            <span>{text:Activity 2}</span>
                        </div>
                    {/block:ifActivity2}
        
                    {block:ifActivity3}
                        <div class="activity">
                            {block:ifActivity3Icon}
                                <i class="ph-light ph-{text:Activity 3 Icon} activity-icon"></i>
                            {/block:ifActivity3Icon}
                            <span>{text:Activity 3}</span>
                        </div>
                    {/block:ifActivity3}
        
                    {block:ifActivity4}
                        <div class="activity">
                            {block:ifActivity4Icon}
                                <i class="ph-light ph-{text:Activity 4 Icon} activity-icon"></i>
                            {/block:ifActivity4Icon}
                            <span>{text:Activity 4}</span>
                        </div>
                    {/block:ifActivity4}
                </div>
            </div>
        </div>
    {/block:ifUpdateTab}
</div>
    
<div class="corner-controls bottom flex column gap1">
    <button class="scroll-to-top corner-button" type="button" aria-label="Scroll to top" title="Scroll to top">
        <i class="ph ph-caret-up"></i>
    </button>
    <a class="credit corner-button" target="_blank" href="https://THEME-MAKER-URL-HERE.tumblr.com/" title="Credit" aria-label="Visit THEME-MAKER-URL-HERE Tumblr for more information" rel="noopener noreferrer"><i class="ph ph-code"></i>
    </a>
</div>

<!-- 
    Sidebar image blob shapes:

    These invisible <svg> elements define clipPaths (#blob1, #blob2) 
    that are applied to sidebar images using the .blob1 and .blob2 classes.

    The SVGs are hidden with height="0" width="0" and positioned absolute,
    so they don't affect layout but remain available for clip-path usage.
-->
<svg aria-hidden="true" focusable="false" height="0" width="0" style="position:absolute; width:0px; height:0px;"><clipPath id="blob1" clipPathUnits="objectBoundingBox"><path d="M0.5,0.053c0.266,-0.074 0.242,0.198 0.44,0.447c0.161,0.204 -0.209,0.435 -0.44,0.455c-0.275,0.023 -0.516,-0.183 -0.471,-0.455c0.037,-0.217 0.235,-0.382 0.471,-0.447Z"></path></clipPath></svg>
<svg aria-hidden="true" focusable="false" viewBox="0 0 390.3 414.4" height="0" width="0" style="position:absolute; width:0px; height:0px;"><clipPath id="blob2" clipPathUnits="objectBoundingBox" transform="scale(0.002562, 0.002413)"><path class="st0" d="M276.8,56.9c23.5,25.9,33.9,61.3,53.7,95.3c19.8,33.9,49,66.4,57.3,104.6c8.2,38.2-4.5,82.3-35.2,102.2 c-30.6,20-79.2,15.8-121.3,23.7c-42.1,7.8-77.8,27.6-118.6,31.1c-40.9,3.5-86.9-9.3-99.3-41.4c-12.3-32.1,8.9-83.4,8.9-127.5 c0-44.2-21.1-81.2-22.3-121.6C-1.1,82.9,17.9,39,51.2,17.6C84.6-3.9,132.3-2.9,174.5,5.8S253.3,30.9,276.8,56.9z"/></clipPath></svg>


<!--Legacy photoset script-->
<script src="https://static.tumblr.com/diajl5m/dgbt13q7x/mournstera-legacy-photoset.js"></script>

<!--unifying legacy and npf audio script -->
<script src="https://static.tumblr.com/diajl5m/LPDt50612/mournstera_unify_audio.js"></script>

<!--Unifying legacy and npf structure of links-->
<script src="https://static.tumblr.com/diajl5m/KOtt506hd/mournstera_unify_links.js"></script>

<!-- For tooltip-->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>

<!-- For tooltip-->
<script src="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/dist/tippy.umd.min.js"></script>

<!-- Phosphor icon script-->
<script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // ------------------------------------------------ TOGGLE TUMBLR CONTROL
    const controls = document.querySelector("button.tumblr-controls");
    const spin = document.querySelector(".spin");
    
    controls.addEventListener("click", function () {
    
        spin.classList.toggle("active");
    
        const iframe = document.querySelector(".tmblr-iframe");
        if (!iframe) return;
    
        iframe.classList.toggle("active");
    
        // Update ARIA attributes for accessibility
        const isExpanded = controls.getAttribute("aria-expanded") === "true";
        controls.setAttribute("aria-expanded", String(!isExpanded));
        iframe.setAttribute("aria-hidden", String(isExpanded));
    
        // Update the button label for screen readers
        controls.setAttribute(
            "aria-label",
            !isExpanded ? "Close Tumblr controls" : "Open Tumblr controls"
        );
    });

    // ------------------------------------------------- SCROLL TO TOP BUTTON
    const html = document.documentElement;
    const scrollButton = document.querySelector(".scroll-to-top");
    
    document.addEventListener("scroll", function () {
        const isVisible = html.scrollTop > 70;
    
        scrollButton.classList.toggle("visible", isVisible);
        scrollButton.setAttribute("aria-hidden", String(!isVisible));
    });
    
    scrollButton.addEventListener("click", function () {
        window.scrollTo({
            top: 0,
            behavior: "smooth"
        });
    });

    // --------------------------------------------------- NOTE COUNT SHORTEN
    document.querySelectorAll(".notecount").forEach(noteCountElement => {
        const noteCount = parseInt(noteCountElement.textContent.replace(/,/g, "").split(" ")[0], 10);
    
        if (noteCount >= 1000) {
            const formattedCount = (noteCount >= 1000000)
                ? `${(noteCount / 1000000).toFixed(2)}m `
                : `${(noteCount / 1000).toFixed(1)}k`;
            noteCountElement.textContent = `${ formattedCount }`;
        }
    });
    
    {block:ifToggleLabel}
    // --------------------------------------------------- TOGGLE NAV
    const subMenuBtn = document.querySelector(".sub-toggle");
    const submenuContainer = document.querySelector("#submenu-container");
    const submenuNav = submenuContainer.querySelector("nav.submenu");
    const navSpin = subMenuBtn.querySelector(".nav-spin");
    
    function toggleSubmenu() {
        const expanded = subMenuBtn.getAttribute("aria-expanded") === "true";
    
        // Update ARIA attributes
        subMenuBtn.setAttribute("aria-expanded", !expanded);
        submenuNav.setAttribute("aria-hidden", expanded);
    
        // Rotate arrow
        navSpin.classList.toggle("active");
    
        // Expand/collapse with dynamic height
        if (!expanded) {
            submenuContainer.style.maxHeight = submenuContainer.scrollHeight + "px";
        } else {
            submenuContainer.style.maxHeight = "0";
        }
    }
    
    // click
    subMenuBtn.addEventListener("click", toggleSubmenu);
    
    // Keyboard (enter / space)
    subMenuBtn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " " || e.key === "Spacebar") {
            e.preventDefault(); // prevent scrolling when using `Space` key
            toggleSubmenu();
        }
    });
    {/block:ifToggleLabel}


    {block:IndexPage}
    // keep the tag scripts inside the index blocks, so they are not rendered
    // on permalink.
    
    // ---------------------------------------------------------- TOGGLE TAGS
    const toggleTagsElements = document.querySelectorAll(".toggle-tags");
    
    toggleTagsElements.forEach(function (element) {
        element.addEventListener("click", function (event) {
            const article = this.closest("article");
            if (!article) return;
    
            const tagsContainer = article.querySelector(".tags-container");
            if (!tagsContainer) return;
    
            const computedMaxHeight = window.getComputedStyle(tagsContainer).maxHeight;
            const isOpen = computedMaxHeight !== "0px" && computedMaxHeight !== "none";
    
            if (isOpen) {
                tagsContainer.style.maxHeight = `${tagsContainer.scrollHeight}px`;
                setTimeout(() => {
                    tagsContainer.style.maxHeight = "0px";
                }, 10);
            } else {
                tagsContainer.style.maxHeight = `${tagsContainer.scrollHeight}px`;
            }
    
            this.classList.toggle("active");
            this.setAttribute("aria-expanded", String(!isOpen));
            event.preventDefault();
        });
    });
    
    // ---------------------------------------------------- TRUNCATED TAGS
    const maxVisibleTags = 3;
    
    document.querySelectorAll(".tags-truncated .tags-container .tags").forEach(tagsContainer => {
        const tags = tagsContainer.querySelectorAll("a");
    
        if (tags.length > maxVisibleTags) {
    
            tags.forEach((tag, index) => {
                if (index < maxVisibleTags) {
                    tag.classList.add("visible");
                    tag.style.display = "inline";
                } else {
                    tag.style.display = "none";
                }
            });
    
            const thirdTag = tags[maxVisibleTags - 1];
            if (thirdTag) {
                thirdTag.classList.add("ellipsis");
            }
    
            const expandLink = document.createElement("a");
            expandLink.href = "#expand";
            expandLink.className = "expand";
            expandLink.textContent = "see all";
    
            // a11y attributes
            expandLink.setAttribute("role", "button");
            expandLink.setAttribute("aria-expanded", "false");
            expandLink.setAttribute("tabindex", "0");
    
            tagsContainer.appendChild(expandLink);
    
            expandLink.addEventListener("click", function (event) {
                event.preventDefault();
    
                tags.forEach(tag => {
                    tag.style.display = "inline";
                });
    
                if (thirdTag) {
                    thirdTag.classList.remove("ellipsis");
                }
    
                expandLink.setAttribute("aria-expanded", "true");
    
                expandLink.remove();
    
                // Announce to screen readers
                const liveRegion = tagsContainer.querySelector(".sr-live");
                if (liveRegion) {
                    liveRegion.textContent = "All tags are now visible.";
                }
            });
    
            // handle keyboard activation for a11y (enter / space)
            expandLink.addEventListener("keydown", function(event) {
                if(event.key === "Enter" || event.key === " ") {
                    event.preventDefault();
                    expandLink.click();
                }
            });
    
        } else {
            tags.forEach(tag => {
                tag.classList.add("visible");
                tag.style.display = "inline";
            });
        }
    });
    {/block:IndexPage}
    
    {block:ifUpdateTab}
    // ------------------------------------------------ UPDATE TAB
    const updTab = document.querySelector(".update-toggle");
    const updates = document.getElementById("updates");
    const icons = updTab.querySelectorAll(".upd-icon");
    
    if (updTab && updates) {
        // tooltip get updated
        const tip = tippy(updTab, {
            ...commonOptions,
            content: "Open update tab",
        });
    
        updTab.addEventListener("click", function () {
            const isExpanded = updTab.getAttribute("aria-expanded") === "true";
    
            // Toggle aria-expanded and aria-hidden
            updTab.setAttribute("aria-expanded", String(!isExpanded));
            updates.classList.toggle("active");
            updates.setAttribute("aria-hidden", String(isExpanded));
    
            // Toggle both icons
            icons.forEach(icon => icon.classList.toggle("hidden"));
    
            // Update tooltip and aria-label dynamically
            const newLabel = !isExpanded ? "Close update tab" : "Open update tab";
            updTab.setAttribute("aria-label", newLabel);
            tip.setContent(newLabel);
        });
    }

    {/block:ifUpdateTab}

});

{block:ifFeaturedTags}
// ------------------------------------------------------------ FEATURED TAGS
function getScript(scriptUrl, callback, errorCallback) {  
    const script = document.createElement('script');
    script.src = scriptUrl;
    script.onload = callback;
    script.onerror = errorCallback;
    document.body.appendChild(script);
}

const featuredTags = document.querySelectorAll('.featured-tags a[href*="/tagged"]');

featuredTags.forEach(tag => {
    const tagged = tag.href.split('/tagged/')[1] || 'unknown';
    const totalSpan = tag.querySelector('.total');
    const tagUrl = `https://{name}.tumblr.com/api/read/json?tagged=${ tagged }`;

    function onErrors() {
        const nameSpan = tag.querySelector('.tagname');
        if (nameSpan) nameSpan.textContent = `${ tagged } not found`;
        if (totalSpan) totalSpan.textContent = '';
    }

    function onLoad() {
        const tagData = window.tumblr_api_read;
        if (tagData && tagData['posts-total'] !== undefined) {
            const total = tagData['posts-total'];
            if (totalSpan) totalSpan.textContent = total;
        } else {
            onErrors();
        }
    }

    getScript(tagUrl, onLoad, onErrors);
});
{/block:ifFeaturedTags}


// ------------------------------------------------------------- TOOLTIP
const commonOptions = {
    theme: "custom",
    arrow: false,
    followCursor: true,
    placement: "top",
    touch: "hold",
    animation: 'smooth-fade',
};

// Here is the tooltips for tag, like and reblog.
// pref with info-only-icons so it only scoops
// and displays with only icons.

tippy(".info-only-icons .like-tooltip", {
    ...commonOptions,
    content: "Like post",
});

tippy(".info-only-icons .rb-tooltip", {
    ...commonOptions,
    content: "Reblog post",
});

tippy(".info-only-icons .tags-tooltip", {
    ...commonOptions,
    content: "Show tags",
});

tippy("[title]", {
    ...commonOptions,
    content(reference) {
        const title = reference.getAttribute("title");
        reference.removeAttribute("title");
        return title;
    },
});

// ---------------------------------------------------------------- DARK MODE
const themeToggleButtons = document.querySelectorAll(".theme-toggle");

themeToggleButtons.forEach((btn) => {
    const storedTheme = localStorage.getItem("theme") ||
        (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");

    const initialTooltipText = storedTheme === "dark" ? "Enable light mode" : "Enable dark mode";

    btn.setAttribute("aria-label", initialTooltipText);
    btn.setAttribute("aria-pressed", storedTheme === "dark");

    tippy(btn, {
        ...commonOptions,
        content: initialTooltipText,
    });

    btn.addEventListener("click", function () {
        const currentTheme = document.documentElement.getAttribute("data-theme");
        const targetTheme = currentTheme === "light" ? "dark" : "light";

        document.documentElement.classList.add("theme-transition");
        document.documentElement.setAttribute("data-theme", targetTheme);
        localStorage.setItem("theme", targetTheme);

        const tooltipText = targetTheme === "dark" ? "Enable light mode" : "Enable dark mode";
        btn._tippy.setContent(tooltipText);
        btn.setAttribute("aria-label", tooltipText);
        btn.setAttribute("aria-pressed", targetTheme === "dark");

        setTimeout(() => {
            document.documentElement.classList.remove("theme-transition");
        }, 50);
    });
});

// ----------------------------------------------------------- WRAP LEGACY ASK IN <p>
// legacy ask questions did not have any <p> so now it matches npf ask questions
// and can be styled alike.

  document.querySelectorAll('.ask-body').forEach(q => {
    if (!q.querySelector('*') && q.textContent.trim()) {
      const p = document.createElement('p');
      p.textContent = q.textContent;
      q.textContent = '';
      q.appendChild(p);
    }
  });

// --------------------------------------------------------- DISPLAY NPF POST
// reverse-compatible-template.html by @egg.design
// REMOVE EMPTY p
for (const p of document.querySelectorAll('p')) {
    if (p.innerHTML.trim() === '') {
       p.remove()
    }
}

// create posts array
let posts = []
{block:Posts} 
    posts.push({ npf: JSON.parse({JSNPF}), id: {JSPostId}}) 
{/block:Posts}

//function for updating post types 
function updateTypes(type, article) {
    article.classList.remove('text-post')
    article.classList.add(`${ type }-post`, 'npf-post')
}

// loop through array to get each post
for (const post of posts) {
   let npf = post.npf
   let article = document.getElementById(`post-${post.id}`)
   // select captions that have something in them
   let caption = article.querySelector('.caption:is(:not(:empty))')
   if (caption != null && article.classList.contains('text-post')) {
      // if content exists
      if (npf.trail.length || npf.content.length) {
          // assign various post types based on NPF data
            switch (npf.trail[0]?.content[0]?.type ?? npf.content[0].type) {
            case 'image':
               updateTypes('photos', article)
               if (article.querySelector('.npf_row') == null) {
                   caption.prepend(article.querySelector('figure'))
               }
               break
            case 'video':
               updateTypes('video', article)
               let video = article.querySelector('figure')
               caption.prepend(video)
               break
            case 'link':
              updateTypes('link', article)
            case 'audio':
               updateTypes('audio', article)
                break
            case 'quote':
                updateTypes('quote', article)
            }
          
         // if there are photos
         if (article.classList.contains('photos-post')) {
            let photoset = document.createElement('div')
            photoset.classList.add('npf-photos')
            caption.prepend(photoset)
            // find where a photoset would be split up by another content block
            let photoBreak = article.querySelector('.reblog-content p, .reblog-content h1, .reblog-content h2, .reblog-content blockquote')
            let elements = []
            if (photoBreak) {
               let prevElement = photoBreak.parentNode.firstElementChild
               while (prevElement !== photoBreak) {
                  elements.push(prevElement)
                  prevElement = prevElement.nextElementSibling
               }
            }
            // if there is nothing that breaks up the photoset, select all rows
            else {
               elements = article.querySelectorAll('.npf_row')
            }
            // move each row to the top
            for (const el of elements) {
               photoset.append(el)
            }
            if (article.querySelectorAll('.npf_row').length > 1) {
                updateTypes('photoset', article)
            }
            else {
                updateTypes('photo', article)
            }
         }
         
         // clean up any potential stray reblog headers
         let reblogHeader = article.querySelector('.reblog-header')
         let reblogContent = article.querySelector('.reblog-content') 
         if (reblogHeader?.nextElementSibling === reblogContent && reblogContent?.childElementCount === 0) {
            reblogHeader.remove()
            reblogContent.remove()
         }
      }
   }
}

// wrap npf photoset in div that's not the first photoset
const content = document.querySelectorAll(".reblog-content");
let sections = []; // initialize empty array it'll be useful later !
let temp_array = []; // will also be useful

// We will re-create all the div "reblog-content".
function removeAndReplace(content_div) {
    content_div.replaceChildren();
    let idx = 0;

    for (const array_containing_the_arrays_of_child_nodes of sections) {
        const div = document.createElement("div");
        array_containing_the_arrays_of_child_nodes[0].classList.contains("npf_row") ? ++idx : null;
        for (const child_nodes_array of array_containing_the_arrays_of_child_nodes) {
            if (!child_nodes_array.classList.contains("npf_row")) {
                content_div.appendChild(child_nodes_array);
            } else {
                div.appendChild(child_nodes_array);
            }
        }
        div.classList.add(`more_photoset`);
        div.children.length <= 0 ? null : content_div.appendChild(div);
    }
    sections = [];
}

function y() {
    content.forEach((content) => {
        const content_children = content.children;
        for (let i = 0; i < content_children.length; ++i) {
            const children = content_children[i];
            if (!children.classList.contains("npf_row")) {
                temp_array.length >= 1 ? sections.push(temp_array, [children]) : sections.push([children]);
                temp_array = [];
            } else {
                temp_array.push(children);
                if (content_children[content_children.length - 1] === children) {
                    sections.push(temp_array);
                    temp_array = [];
                }
            }
        }
        removeAndReplace(content);
    });
}

y();
</script>
</body>
</html>